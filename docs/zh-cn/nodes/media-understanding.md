---
summary: "入站图片/音频/视频理解 - 可选的提供商 + CLI 回退机制"
read_when:
  - 设计或重构媒体理解
  - 调优入站音频/视频/图片预处理
  - 配置媒体理解模型
title: "媒体理解"
---

# 🧠 媒体理解（入站）

## 学习目标

完成本章节学习后，你将能够：

### 基础目标（必掌握）

- [ ] 理解 **媒体理解** 的工作原理和设计目标
- [ ] 掌握图片、音频、视频的 AI 分析流程
- [ ] 理解可选预处理的原理和配置方法
- [ ] 完成基础的媒体理解配置

### 进阶目标（建议掌握）

- [ ] 配置多种 AI 模型实现故障转移
- [ ] 优化转录和分析质量
- [ ] 配置范围限制和附件策略

### 专家目标（挑战）

- [ ] 自定义预处理管道
- [ ] 集成私有 AI 模型
- [ ] 大规模媒体处理优化

---

## 为什么需要媒体理解？

在理解具体用法之前，我们需要先理解**设计者为什么引入媒体理解功能**。这不仅帮助你更好地使用 AI 分析功能，还能让你在优化媒体处理流程时做出更好的设计决策。

### 设计决策背景

**问题**：入站媒体文件需要被 AI 理解和分析，但原始文件可能过大或 AI 无法直接处理

**可选方案**：

1. 方案 A - 直接传递原始文件：AI 可能无法处理，且传输成本高
2. 方案 B - 强制摘要：丢失原始信息，无法深度分析
3. 方案 C（最终选择）- 可选预处理：摘要辅助 + 原始保留

**选择理由**：

- 理由一：摘要帮助 AI 快速理解内容
- 理由二：原始媒体保留支持深度分析
- 理由三：多种模型支持实现高可用

### 媒体理解架构图

```
┌─────────────────────────────────────────────────────────────┐
│                    媒体理解系统架构                            │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  入站媒体消息                                                 │
│      │                                                       │
│      ▼                                                       │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  1. 收集附件信息                                      │   │
│  │     - MediaPaths（本地路径）                           │   │
│  │     - MediaUrls（远程 URL）                           │   │
│  │     - MediaTypes（媒体类型）                           │   │
│  └─────────────────────────────┬───────────────────────────┘   │
│                                │                               │
│                                ▼                               │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  2. 附件选择（按能力）                                 │   │
│  │     - image → 图片附件                                │   │
│  │     - audio → 音频附件                                │   │
│  │     - video → 视频附件                                │   │
│  └─────────────────────────────┬───────────────────────────┘   │
│                                │                               │
│                                ▼                               │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  3. 模型选择                                          │   │
│  │     - 按配置顺序尝试                                  │   │
│  │     - 检查能力匹配                                    │   │
│  │     - 检查认证信息                                    │   │
│  └─────────────────────────────┬───────────────────────────┘   │
│                                │                               │
│                ┌───────────────┴───────────────┐               │
│                │                               │               │
│                ▼                               ▼               │
│        ┌───────────────┐               ┌───────────────┐     │
│        │   处理成功     │               │   处理失败     │     │
│        │               │               │               │     │
│        ▼               │               ▼               │     │
│  ┌───────────┐         │       ┌───────────┐         │     │
│  │ 插入块    │         │       │ 尝试下一个│         │     │
│  │ [Image]   │         │       │   模型    │         │     │
│  │ [Audio]   │         │       └───────────┘         │     │
│  │ [Video]   │         │                           │     │
│  └───────────┘         │                           │     │
│                        │                           │     │
│                        └───────────────────────────┘     │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

---

## 核心概念速查

| 概念 | 定义 | 关键特性 |
|------|------|---------|
| **媒体理解** | 将媒体内容摘要为文字的预处理功能 | 可选启用、AI 分析、结果注入 |
| **提供商模型** | 使用云服务 API 进行媒体分析 | OpenAI、Anthropic、Google |
| **CLI 模型** | 使用本地命令行工具进行分析 | whisper、gemini CLI |
| **故障转移** | 主服务失败时自动切换到备用服务 | 顺序回退、错误处理 |

---

## 适用场景分析

### 场景一：图片内容分析

**需求**：让 AI 理解用户发送的图片内容

**解决方案**：

```
用户发送图片 → AI 分析摘要 → [Image] 块注入 → AI 深度理解 → 回复
```

**实际案例**：

- 商品图片比价
- 植物/动物识别
- 文档内容理解
- 场景描述生成

### 场景二：音频转录

**需求**：将语音消息转换为文字

**解决方案**：

```
用户发送语音 → 语音转文字 → [Audio] 块注入 → AI 分析 → 回复
```

**实际案例**：

- 会议录音转文字
- 语音消息处理
- 多语言转录

### 场景三：视频分析

**需求**：理解视频内容并提取关键信息

**解决方案**：

```
用户发送视频 → 视频分析摘要 → [Video] 块注入 → AI 分析 → 回复
```

**实际案例**：

- 视频内容摘要
- 关键帧提取
- 行为分析

---

## 专家思维模型：媒体理解优化框架

当优化媒体理解流程时，专家会采用以下思维框架：

### 优化维度分析

```
媒体理解质量
    │
    ├─→ 摘要准确性
    │   ├─→ 模型选择
    │   ├─→ 提示词优化
    │   └─→ 参数调整
    │
    ├─→ 处理速度
    │   ├─→ 模型响应时间
    │   ├─→ 故障转移策略
    │   └─→ 并发控制
    │
    ├─→ 成本控制
    │   ├─→ API 调用费用
    │   ├─→ 本地资源消耗
    │   └─→ 缓存策略
    │
    └─→ 覆盖率
        ├─→ 文件大小限制
        ├─→ 格式支持
        └─→ 范围配置
```

### 故障转移决策树

```
媒体理解失败？
    │
    ├─→ 大小超限？
    │   ├─→ 是 → 跳过该模型，尝试下一个
    │   │
    │   └─→ 否 → 检查认证
    │               │
    │               ├─→ 认证失败 → 尝试下一个模型
    │               │
    │               └─→ 检查超时
    │                           │
    │                           ├─→ 超时 → 尝试下一个模型
    │                           │
    │                           └─→ 检查其他错误
    │                                       │
    │                                       ├─→ 可恢复 → 重试当前模型
    │                                       │
    │                                       └─→ 不可恢复 → 尝试下一个模型
```

---

## 学习路径规划

### 阶段一：基础概念（1-2 小时）

**目标**：建立媒体理解的认知框架

1. 阅读本教程，理解处理流程
2. 完成基础模型配置
3. 测试图片理解功能

### 阶段二：核心功能（2-4 小时）

**目标**：掌握实际使用中最常用的功能

4. 配置多种故障转移模型
5. 优化音频转录
6. 配置范围限制

### 阶段三：高级应用（4-8 小时）

**目标**：解决复杂场景和高级需求

7. 自定义提示词
8. 配置附件策略
9. 优化性能

### 阶段四：专家实战（8+ 小时）

**目标**：解决真实世界的复杂问题

10. 大规模部署
11. 私有化模型集成
12. 自定义处理管道

---

## 渐进式复杂度：模型对比

### 图片理解模型

| 提供商 | 模型 | 特点 | 适用场景 |
|-------|------|------|---------|
| OpenAI | gpt-4o | 通用能力强 | 复杂场景理解 |
| Anthropic | claude-opus-4 | 推理能力强 | 分析推理任务 |
| Google | gemini-3-pro | 多模态优秀 | 多语言场景 |
| OpenAI | gpt-4o-mini | 快速低成本 | 简单识别 |

### 音频理解模型

| 提供商 | 模型 | 特点 | 适用场景 |
|-------|------|------|---------|
| OpenAI | gpt-4o-mini-transcribe | 快速低成本 | 日常转录 |
| Groq | whisper-large-v3-turbo | 超快速 | 实时转录 |
| Deepgram | nova-3 | 高精度 | 专业转录 |

### 视频理解模型

| 提供商 | 模型 | 特点 | 适用场景 |
|-------|------|------|---------|
| Google | gemini-3-flash-preview | 快速 | 短视频分析 |
| Google | gemini-3-pro-preview | 丰富细节 | 长视频分析 |

### 复杂度等级说明

| 等级 | 描述 | 示例任务 |
|-----|------|---------|
| **Level 1 ⭐** | 基础模型配置 | 配置单个提供商模型 |
| **Level 2 ⭐⭐** | 故障转移配置 | 配置主备模型切换 |
| **Level 3 ⭐⭐⭐** | 高级参数调整 | 自定义提示词、范围限制 |
| **Level 4 ⭐⭐⭐⭐** | 自定义集成 | 私有模型、大规模优化 |

---

## 故障排查实战

### 场景一：理解失败

**问题描述**：媒体文件没有被理解分析

**排查步骤**：

1. **检查配置**

   ```bash
   openclaw config get tools.media
   ```

2. **查看详细日志**

   ```bash
   openclaw logs --lines 100 | grep "media"
   ```

3. **检查状态**

   ```bash
   openclaw status | grep media
   ```

4. **手动测试模型**

   ```bash
   # 测试 OpenAI 图片理解
   curl -X POST "https://api.openai.com/v1/chat/completions" \
     -H "Authorization: Bearer $OPENAI_API_KEY" \
     -d '{
       "model": "gpt-4o",
       "messages": [{
         "role": "user",
         "content": [
           {"type": "text", "text": "描述这张图片"},
           {"type": "image_url", "image_url": {"url": "https://example.com/image.jpg"}}
         ]
       }]
     }'
   ```

**解决方案**：

- 正确配置模型和认证
- 确保文件在大小限制内
- 检查网络连接

### 场景二：大小限制问题

**问题描述**：大文件被跳过处理

**排查步骤**：

1. **检查当前限制**

   ```bash
   openclaw config get tools.media.image.maxBytes
   openclaw config get tools.media.audio.maxBytes
   openclaw config get tools.media.video.maxBytes
   ```

2. **调整限制**

   ```bash
   openclaw config set tools.media.image.maxBytes 20971520    # 20MB
   openclaw config set tools.media.audio.maxBytes 52428800   # 50MB
   openclaw config set tools.media.video.maxBytes 104857600  # 100MB
   ```

3. **分段处理**

   - 视频：截取关键片段
   - 音频：分段转录
   - 图片：调整分辨率

**解决方案**：

- 按需调整大小限制
- 预处理超大文件
- 配置多个模型分担

### 场景三：模型错误

**问题描述**：特定模型返回错误

**排查步骤**：

1. **检查认证**

   ```bash
   echo $OPENAI_API_KEY
   echo $ANTHROPIC_API_KEY
   ```

2. **测试 API 连接**

   ```bash
   curl -s https://api.openai.com/v1/models \
     -H "Authorization: Bearer $OPENAI_API_KEY"
   ```

3. **查看错误日志**

   ```bash
   openclaw logs --verbose | grep "model"
   ```

**解决方案**：

- 修复 API Key 配置
- 使用备用模型
- 联系服务提供商

---

## 最佳实践

### 实践一：图片理解配置

**目标**：可靠的图片理解能力

```json5
{
  tools: {
    media: {
      image: {
        enabled: true,
        maxBytes: 10485760,  // 10MB
        maxChars: 500,
        models: [
          {
            provider: "openai",
            model: "gpt-4o",
            prompt: "用不超过 500 字描述这张图片的内容，包括主要对象、场景、颜色和任何文字信息。"
          },
          {
            provider: "anthropic",
            model: "claude-sonnet-4-20250514"
          }
        ]
      }
    }
  }
}
```

**最佳实践要点**：

- 配置多个提供商实现高可用
- 设置合理的 maxChars
- 优化提示词提高准确性

### 实践二：音频转录配置

**目标**：快速准确的音频转录

```json5
{
  tools: {
    media: {
      audio: {
        enabled: true,
        maxBytes: 20971520,  // 20MB
        models: [
          {
            provider: "openai",
            model: "gpt-4o-mini-transcribe"
          },
          {
            type: "cli",
            command: "whisper",
            args: ["--model", "base", "{{MediaPath}}"],
            timeoutSeconds: 60
          }
        ]
      }
    }
  }
}
```

**最佳实践要点**：

- 云服务优先保证速度
- CLI 回退保护隐私
- 设置合理超时

### 实践三：故障转移配置

**目标**：高可用的媒体理解

```json5
{
  tools: {
    media: {
      image: {
        enabled: true,
        models: [
          {
            provider: "openai",
            model: "gpt-4o",
            capabilities: ["image"],
            timeoutSeconds: 60
          },
          {
            provider: "anthropic",
            model: "claude-sonnet-4-20250514",
            capabilities: ["image"],
            timeoutSeconds: 90
          },
          {
            type: "cli",
            command: "gemini",
            args: ["-m", "gemini-3-flash", "--read-file", "{{MediaPath}}"],
            timeoutSeconds: 120
          }
        ]
      }
    }
  }
}
```

**最佳实践要点**：

- 按优先级排列模型
- 设置合理的超时
- 包含本地 CLI 回退

---

## CLI 命令参考

### 媒体理解命令

| 命令 | 说明 |
|------|------|
| `openclaw status` | 查看媒体理解状态 |
| `openclaw config get tools.media` | 查看媒体配置 |
| `openclaw config set tools.media.image.enabled false` | 禁用图片理解 |

### 手动测试命令

```bash
# 测试本地 CLI 转录
whisper audio.mp3 --model base --output_dir ./output

# 测试 Gemini CLI
gemini -m gemini-3-flash --read-file image.jpg

# 测试 API
curl -X POST "https://api.openai.com/v1/audio/transcriptions" \
  -H "Authorization: Bearer $OPENAI_API_KEY" \
  -F "file=@audio.mp3" \
  -F "model=whisper-1"
```

---

## 原理解析：处理流程详解

### 模型选择逻辑

```
入站媒体
    │
    ▼
┌─────────────────────┐
│  能力匹配            │  ← image/audio/video
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│  大小检查            │  ← maxBytes
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│  认证检查            │  ← API Key
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│  按顺序尝试          │
│  ┌─────────────────┐│
│  │ 模型 1 → 成功？ ││
│  └────────┬────────┘│
│           │          │
│          否         是
│           │          │
│           ▼          ▼
│  ┌─────────────────┐  ┌───────┐
│  │ 模型 2 → 成功？ │  │ 使用  │
│  └────────┬────────┘  │ 结果  │
│           │             └───────┘
│          否
│           │
│           ▼
│  ┌─────────────────┐
│  │ 模型 3 → 成功？ ││
│  └────────┬────────┘│
│           │          │
│          否         是
│           │          │
│           ▼          ▼
│         跳过       使用
│         处理       结果
```

### 插入内容格式

| 媒体类型 | 插入内容 | 特殊变量 |
|----------|---------|---------|
| 图片 | `[Image] 块 + 描述` | - |
| 音频 | `[Audio] 块 + 转录` | `{{Transcript}}` |
| 视频 | `[Video] 块 + 描述` | - |

### 状态输出示例

```
openclaw status
# 输出示例：
# 📎 Media: image ok (openai/gpt-4o) · audio skipped (maxBytes) · video ok (google/gemini-3)
```

---

## 总结

媒体理解是 OpenClaw 实现 AI 感知多媒体内容的关键功能。通过可选的预处理，你可以：

- 让 AI 理解图片内容
- 将语音转换为文字
- 分析视频关键信息
- 配置多种模型实现高可用

掌握媒体理解的配置和使用，将极大地扩展 AI 助手理解和分析多媒体内容的能力。

---

## 进阶学习路径

| 级别 | 主题 | 资源 |
|-----|------|-----|
| ⭐ | 基础模型配置 | [快速开始](/zh-CN/start/quick-start) |
| ⭐⭐ | 故障转移配置 | [音频处理](/zh-CN/nodes/audio) |
| ⭐⭐⭐ | 高级参数调整 | [图片处理](/zh-CN/nodes/images) |
| ⭐⭐⭐⭐ | 自定义集成 | [开发者文档](/zh-CN/developers) |

---

## 相关文档

- [图片与媒体支持](/zh-CN/nodes/images) - 媒体处理概述
- [音频处理](/zh-CN/nodes/audio) - 音频转录
- [相机捕获](/zh-CN/nodes/camera) - 图像捕获
- [配置参考](/zh-CN/config/reference) - 完整配置选项

---

**媒体理解让 AI 能够"看懂"和"听懂"用户分享的内容！** 🦞