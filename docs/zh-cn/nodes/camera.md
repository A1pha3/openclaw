---
summary: "相机捕获 - iOS/Android/macOS 节点拍照和录像功能"
read_when:
  - 添加或修改 iOS/Android/macOS 节点相机捕获
  - 扩展代理可访问的媒体临时文件工作流
title: "相机捕获"
---

# 📷 相机捕获

## 学习目标

完成本章节学习后，你将能够：

### 基础目标（必掌握）

- [ ] 理解 **相机捕获系统** 的工作原理
- [ ] 掌握三种平台（iOS/Android/macOS）的相机功能差异
- [ ] 理解权限模型和前置要求
- [ ] 完成基础的拍照和录像配置

### 进阶目标（建议掌握）

- [ ] 配置多相机管理和选择
- [ ] 优化图片质量和视频编码
- [ ] 处理特殊拍摄场景

### 专家目标（挑战）

- [ ] 自定义相机参数和预处理
- [ ] 集成第三方相机功能
- [ ] 优化大规模图像处理

---

## 为什么需要相机捕获？

在理解具体用法之前，我们需要先理解**设计者为什么引入相机捕获功能**。这不仅帮助你更好地使用相机功能，还能让你在优化图像捕获流程时做出更好的设计决策。

### 设计决策背景

**问题**：AI 助手需要"看见"物理世界，理解用户拍摄的内容

**可选方案**：

1. 方案 A - 仅使用网络图片：无法处理本地拍摄内容
2. 方案 B - 集成系统相机 API：平台差异大，复杂度高
3. 方案 C（最终选择）- 统一的节点相机接口：屏蔽平台差异

**选择理由**：

- 理由一：统一的 CLI 接口简化使用
- 理由二：自动处理平台差异
- 理由三：完善的权限管理保证安全

### 相机捕获架构图

```
┌─────────────────────────────────────────────────────────────┐
│                    相机捕获系统架构                            │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌─────────────────────────────────────────────────────────┐│
│  │                    CLI 命令层                            ││
│  │  openclaw nodes camera snap / clip                      ││
│  └────────────────────────────┬──────────────────────────────┘│
│                               │                               │
│                               ▼                               │
│  ┌─────────────────────────────────────────────────────────┐│
│  │                    网关转发层                            ││
│  │  - WebSocket 消息路由                                   ││
│  │  - 节点选择和绑定                                       ││
│  │  - 结果聚合                                            ││
│  └────────────────────────────┬──────────────────────────────┘│
│                               │                               │
│                               ▼                               │
│  ┌─────────────────────────────────────────────────────────┐│
│  │                    节点执行层                            ││
│  │                                                         ││
│  │  ┌───────────┐  ┌───────────┐  ┌───────────┐          ││
│  │  │ iOS 节点  │  │Android 节点│  │macOS 节点│          ││
│  │  │          │  │          │  │          │          ││
│  │  │ AVFoundation│  │CameraX  │  │AVFoundation│          ││
│  │  │ 拍照/录像 │  │ 拍照/录像 │  │ 拍照/录像 │          ││
│  │  └───────────┘  └───────────┘  └───────────┘          ││
│  └────────────────────────────┬──────────────────────────────┘│
│                               │                               │
│                               ▼                               │
│  ┌─────────────────────────────────────────────────────────┐│
│  │                    结果处理层                            ││
│  │  - Base64 编码                                          ││
│  │  - 格式转换                                             ││
│  │  - 大小优化                                             ││
│  └─────────────────────────────────────────────────────────┘│
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

---

## 核心概念速查

| 概念 | 定义 | 关键特性 |
|------|------|---------|
| **相机捕获** | 通过节点设备拍摄图片或视频的功能 | 拍照、录像、实时预览 |
| **节点前置要求** | 执行相机命令的前置条件 | 应用必须在前台 |
| **相机选择** | 指定使用前置或后置相机 | facing 参数控制 |
| **结果编码** | 将媒体转换为可传输格式 | Base64 编码、格式转换 |

---

## 适用场景分析

### 场景一：文档扫描

**需求**：拍摄文档并提取文字内容

**解决方案**：

```
拍摄文档 → 图片上传 → OCR 处理 → 文字提取
```

**实际案例**：

- 发票扫描录入
- 名片信息提取
- 纸质文档数字化

### 场景二：视觉问答

**需求**：向 AI 展示图片并获取分析

**解决方案**：

```
拍摄图片 → AI 视觉理解 → 问题回答
```

**实际案例**：

- 商品比价查询
- 植物识别
- 服装搭配建议

### 场景三：视频分析

**需求**：录制短视频并分析内容

**解决方案**：

```
录制视频 → 关键帧提取 → AI 分析 → 结果反馈
```

**实际案例**：

- 动作指导
- 运动分析
- 实时场景描述

---

## 专家思维模型：相机问题排查框架

当相机功能出现问题时，专家会采用以下思维框架快速定位问题：

### 排查流程图

```
相机问题
    │
    ├─→ 命令执行失败？
    │   ├─→ 检查节点状态
    │   ├─→ 检查前置要求
    │   └─→ 检查权限配置
    │
    ├─→ 图像质量问题？
    │   ├─→ 检查相机参数
    │   ├─→ 检查环境光线
    │   └─→ 检查设备性能
    │
    └─→ 性能问题？
        ├─→ 检查文件大小
        ├─→ 检查编码设置
        └─→ 检查网络传输
```

### 常见问题速查表

| 问题症状 | 可能原因 | 排查步骤 |
|---------|---------|---------|
| 相机无法启动 | 权限未授予、节点未在前台 | 1. 检查系统权限<br>2. 确保节点在前台<br>3. 重启节点应用 |
| 拍照模糊 | 镜头脏污、对焦问题、光线不足 | 1. 清洁镜头<br>2. 调整拍摄距离<br>3. 增加环境光线 |
| 录像卡顿 | 性能不足、存储速度慢 | 1. 降低分辨率<br>2. 清理存储空间<br>3. 使用高速存储 |
| 传输失败 | 文件过大、网络不稳定 | 1. 压缩文件<br>2. 调整编码设置<br>3. 检查网络连接 |

---

## 学习路径规划

### 阶段一：基础概念（1-2 小时）

**目标**：建立相机捕获的认知框架

1. 阅读本教程，理解系统架构
2. 完成平台权限配置
3. 测试基础拍照功能

### 阶段二：核心功能（2-4 小时）

**目标**：掌握实际使用中最常用的功能

4. 配置相机参数和选项
5. 实现拍照和录像功能
6. 处理多相机场景

### 阶段三：高级应用（4-8 小时）

**目标**：解决复杂场景和高级需求

7. 优化图像质量
8. 实现实时视频流
9. 自定义编码参数

### 阶段四：专家实战（8+ 小时）

**目标**：解决真实世界的复杂问题

10. 大规模图像处理
11. 自定义相机集成
12. 性能优化

---

## 渐进式复杂度：平台功能对比

### 平台功能矩阵

| 功能 | iOS | Android | macOS |
|-----|-----|---------|-------|
| 拍照 | ✅ | ✅ | ✅ |
| 录像 | ✅ | ✅ | ✅ |
| 前置相机 | ✅ | ✅ | ✅ |
| 后置相机 | ✅ | ✅ | ✅ |
| 多相机支持 | ✅ | ✅ | ❌ |
| 实时预览 | ✅ | ✅ | ✅ |
| RAW 格式 | ✅ | ✅ | ❌ |
| 手动对焦 | ✅ | ✅ | ❌ |
| 曝光调节 | ✅ | ✅ | ❌ |

### 复杂度等级说明

| 等级 | 描述 | 示例任务 |
|-----|------|---------|
| **Level 1 ⭐** | 基础拍照和录像 | 使用默认参数拍照、录制短视频 |
| **Level 2 ⭐⭐** | 参数调整和选择 | 切换前后相机、调整质量参数 |
| **Level 3 ⭐⭐⭐** | 高级功能使用 | 定时拍摄、连拍、实时预览 |
| **Level 4 ⭐⭐⭐⭐** | 自定义集成 | 自定义相机参数、第三方集成 |

---

## 故障排查实战

### 场景一：相机不可用

**问题描述**：调用相机命令时返回错误

**排查步骤**：

1. **检查节点状态**

   ```bash
   openclaw nodes status --node <node-id>
   ```

2. **检查相机列表**

   ```bash
   openclaw nodes camera list --node <node-id>
   ```

3. **检查节点前置要求**

   - iOS/Android 节点要求应用在前台
   - 后台调用返回 `NODE_BACKGROUND_UNAVAILABLE`

4. **查看详细日志**

   ```bash
   openclaw logs --lines 50 | grep camera
   ```

**解决方案**：

- 将节点应用切换到前台
- 检查相机权限
- 重启节点应用

### 场景二：拍照失败

**问题描述**：拍照命令执行但没有返回图片

**排查步骤**：

1. **检查相机参数**

   ```bash
   openclaw nodes camera snap --node <node-id> --max-width 1600 --quality 0.9
   ```

2. **检查存储空间**

   ```bash
   # 设备存储检查
   df -h
   ```

3. **尝试简化参数**

   ```bash
   # 使用默认参数拍照
   openclaw nodes camera snap --node <node-id>
   ```

4. **检查图片大小限制**

   - Base64 编码会增加约 33% 大小
   - 建议单张图片不超过 5MB

**解决方案**：

- 清理设备存储空间
- 调整图片质量参数
- 分批处理大量拍照

### 场景三：视频过大

**问题描述**：录制的视频无法传输或处理

**排查步骤**：

1. **减少视频时长**

   ```bash
   openclaw nodes camera clip --node <node-id> --duration 5s
   ```

2. **降低帧率**

   ```bash
   openclaw nodes screen record --node <node-id> --fps 10
   ```

3. **禁用音频**

   ```bash
   openclaw nodes camera clip --node <node-id> --no-audio --duration 10s
   ```

4. **检查文件大小**

   ```bash
   ls -lh video.mp4
   ```

**解决方案**：

- 缩短录制时长
- 降低分辨率和帧率
- 禁用音频轨道

---

## 最佳实践

### 实践一：移动节点配置

**目标**：优化移动设备的相机使用

```json5
{
  "nodes": {
    "camera": {
      "enabled": true,
      "defaultFacing": "back",
      "maxWidth": 1600,
      "quality": 0.9,
      "maxDurationMs": 30000,
      "autoUpload": true
    }
  }
}
```

**最佳实践要点**：

- 后置相机作为默认
- 合理设置最大分辨率
- 限制最大录制时长

### 实践二：图片质量优化

**目标**：平衡质量和传输效率

```json5
{
  "tools": {
    "media": {
      "image": {
        "enabled": true,
        "maxBytes": 5242880,  // 5MB
        "quality": 0.85,
        "maxWidth": 2048
      }
    }
  }
}
```

**最佳实践要点**：

- 限制最大文件大小
- 适当降低质量参数
- 使用渐进式编码

### 实践三：批量处理配置

**目标**：高效处理大量图片

```json5
{
  "tools": {
    "media": {
      "image": {
        "enabled": true,
        "concurrency": 2,
        "timeoutSeconds": 30,
        "attachments": {
          "mode": "all",
          "maxAttachments": 5
        }
      }
    }
  }
}
```

**最佳实践要点**：

- 控制并发数量避免过载
- 设置合理超时时间
- 限制单次处理数量

---

## CLI 命令参考

### 拍照命令

| 命令 | 说明 |
|------|------|
| `openclaw nodes camera snap --node <id>` | 默认拍照 |
| `openclaw nodes camera snap --node <id> --facing front` | 前置相机拍照 |
| `openclaw nodes camera snap --node <id> --facing back` | 后置相机拍照 |
| `openclaw nodes camera snap --node <id> --max-width 1600 --quality 0.9` | 自定义参数拍照 |

### 录像命令

| 命令 | 说明 |
|------|------|
| `openclaw nodes camera clip --node <id> --duration 3000` | 默认 3 秒录像 |
| `openclaw nodes camera clip --node <id> --facing back --duration 5000` | 后置相机 5 秒录像 |
| `openclaw nodes camera clip --node <id> --no-audio --duration 10s` | 无音频录像 |

### 屏幕录制命令（macOS）

| 命令 | 说明 |
|------|------|
| `openclaw nodes screen record --node <id> --duration 10s` | 默认屏幕录制 |
| `openclaw nodes screen record --node <id> --duration 10s --fps 15` | 自定义帧率录制 |
| `openclaw nodes screen record --node <id> --duration 10s --no-audio` | 无音频录制 |

### 设备管理命令

| 命令 | 说明 |
|------|------|
| `openclaw nodes camera list --node <id>` | 列出可用相机 |
| `openclaw nodes camera list --node <id> --detailed` | 详细相机信息 |

---

## 原理解析：相机参数详解

### 拍照参数说明

| 参数 | 默认值 | 有效范围 | 说明 |
|-----|--------|---------|------|
| facing | front | front / back | 相机方向 |
| maxWidth | 1600 | 320-4096 | 最大宽度（像素） |
| quality | 0.9 | 0.1-1.0 | JPEG 质量（0-1） |
| format | jpg | jpg | 输出格式 |
| delayMs | 0 | 0-10000 | 延迟拍摄（毫秒） |
| deviceId | - | - | 设备 ID |

### 录像参数说明

| 参数 | 默认值 | 有效范围 | 说明 |
|-----|--------|---------|------|
| facing | front | front / back | 相机方向 |
| durationMs | 3000 | 1000-60000 | 时长（毫秒） |
| includeAudio | true | true / false | 是否包含音频 |
| format | mp4 | mp4 | 输出格式 |
| deviceId | - | - | 设备 ID |

### 结果返回格式

**拍照结果**：

```json
{
  "format": "jpg",
  "base64": "<base64 编码的图片>",
  "width": 1600,
  "height": 1200,
  "size": 1234567
}
```

**录像结果**：

```json
{
  "format": "mp4",
  "base64": "<base64 编码的视频>",
  "durationMs": 3000,
  "hasAudio": true,
  "size": 8765432
}
```

---

## 总结

相机捕获是 OpenClaw 实现视觉感知的关键功能。通过统一的节点接口，你可以：

- 拍照和录像
- 管理多相机选择
- 优化图像质量
- 处理视频内容

掌握相机捕获的配置和使用，将极大地扩展 AI 助手"看见"世界的能力。

---

## 进阶学习路径

| 级别 | 主题 | 资源 |
|-----|------|-----|
| ⭐ | 基础拍照和录像 | [快速开始](/zh-CN/start/quick-start) |
| ⭐⭐ | 参数优化和选择 | [媒体理解](/zh-CN/nodes/media-understanding) |
| ⭐⭐⭐ | 高级功能使用 | [图像处理](/zh-CN/nodes/images) |
| ⭐⭐⭐⭐ | 自定义集成开发 | [开发者文档](/zh-CN/developers) |

---

## 相关文档

- [节点系统](/zh-CN/nodes/index) - 节点概述
- [音频处理](/zh-CN/nodes/audio) - 音频转录
- [屏幕录制](/zh-CN/nodes/screen) - 屏幕视频捕获
- [配置参考](/zh-CN/config/reference) - 完整配置选项

---

**相机捕获让 AI 助手能够"看见"世界！** 🦞