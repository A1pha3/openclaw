---
summary: "OpenClaw Android 节点应用完整指南：网关连接、Canvas 渲染、相机功能、短信集成与电池优化"
read_when:
  - 在 Android 设备上安装和配置 OpenClaw 节点应用
  - 理解 Android 节点如何与网关进行配对和通信
  - 配置 Canvas 渲染、相机拍照、屏幕录制功能
  - 掌握短信功能集成和电池优化配置
  - 排查 Android 节点的连接和功能问题
title: "Android 应用"
---

# OpenClaw Android 节点应用完整指南

本指南全面介绍 OpenClaw 在 Android 平台上的节点应用。Android 应用作为 OpenClaw 的**移动节点**，能够将 Android 设备的功能（如 Canvas 渲染、相机、屏幕录制、短信、语音）暴露给网关，使 agent 能够在 Android 设备上执行操作。与 iOS 节点相比，Android 节点提供了更多系统级别的集成能力，包括短信功能。阅读本指南后，你将能够完成 Android 节点的配对和连接，配置各项功能，并理解其架构设计和限制条件。

## 学习目标

完成本章节学习后，你将能够：

### 基础目标（必掌握）

- [ ] 理解 **Android 节点的角色定位**，明确它与网关、iOS 节点的功能边界
- [ ] 掌握 **网关配对流程**：从发现网关到完成配对的全过程
- [ ] 完成 **基本连接验证**：确认 Android 节点与网关的 WebSocket 连接正常
- [ ] 理解 **NSD 发现机制**，能够诊断局域网发现失败的问题
- [ ] 掌握 **前台服务**的使用，确保网关连接在后台保持

### 进阶目标（建议掌握）

- [ ] 掌握 **Canvas 功能配置**：通过 WebView 实现网页渲染和截图
- [ ] 配置 **相机功能**：拍照和录像的参数调整
- [ ] 配置 **屏幕录制**：了解权限要求和限制条件
- [ ] 理解 **短信功能集成**：配置短信接收和发送
- [ ] 掌握 **电池优化设置**：在性能和电池寿命之间取得平衡

### 专家目标（挑战）

- [ ] 理解 **Tailnet 跨网络发现**，配置 DNS-SD 实现远程连接
- [ ] 掌握 **Android 生命周期管理**：前后台切换、进程回收策略
- [ ] 能够排查 **复杂的网络问题**：NAT 穿透、运营商限制
- [ ] 设计 **多设备协同架构**：Android 节点与其他设备的配合使用
- [ ] 掌握 **短信功能深度定制**：自动化规则和高级配置

---

## 第一部分：核心概念与架构设计

### Android 节点的设计理念

Android 作为开放平台，提供了比 iOS 更丰富的系统集成能力。理解其设计理念有助于你更好地使用这些功能，并理解其独特的优势和挑战。

#### 节点架构的核心思想

```
┌─────────────────────────────────────────────────────────────┐
│                    Android 节点架构                           │
│                                                              │
│   ┌─────────────────────────────────────────────────────┐  │
│   │                    用户交互层                          │  │
│   │   ┌───────────┐  ┌───────────┐  ┌───────────┐      │  │
│   │   │  设置界面  │  │  状态显示  │  │  聊天面板  │      │  │
│   │   └───────────┘  └───────────┘  └───────────┘      │  │
│   └────────────────────────┬────────────────────────────┘  │
│                            │                                 │
│   ┌─────────────────────────────────────────────────────┐  │
│   │                    应用核心层                          │  │
│   │   ┌─────────────────────────────────────────────┐  │  │
│   │   │              节点管理模块                      │  │  │
│   │   │   ├── WebSocket 连接管理（前台服务）         │  │  │
│   │   │   ├── 服务发现（NSD/mDNS）                  │  │  │
│   │   │   ├── 配对状态机                           │  │  │
│   │   │   └── 电池管理模块                          │  │  │
│   │   └─────────────────────────────────────────────┘  │  │
│   └────────────────────────┬────────────────────────────┘  │
│                            │                                 │
│   ┌─────────────────────────────────────────────────────┐  │
│   │                    功能暴露层                          │  │
│   │   ┌──────────┐ ┌──────────┐ ┌──────────┐        │  │
│   │   │  Canvas  │ │  Camera  │ │  Screen  │        │  │
│   │   │  WebView │ │  拍照/录像 │ │  录制    │        │  │
│   │   └──────────┘ └──────────┘ └──────────┘        │  │
│   │   ┌──────────┐ ┌──────────┐ ┌──────────┐        │  │
│   │   │   SMS    │ │  Audio   │ │ Location │        │  │
│   │   │  短信    │ │  语音识别 │ │  位置    │        │  │
│   │   └──────────┘ └──────────┘ └──────────┘        │  │
│   └────────────────────────┬────────────────────────────┘  │
│                            │                                 │
│   ┌─────────────────────────────────────────────────────┐  │
│   │                    通信协议层                          │  │
│   │          WebSocket（网关连接）+ node.invoke 协议       │  │
│   └─────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

#### Android 与 iOS 的架构差异

| 特性 | Android 节点 | iOS 节点 | 技术影响 |
|------|--------------|----------|----------|
| **WebView 引擎** | Android System WebView | WKWebView | 系统集成度不同 |
| **后台服务** | 前台服务（Android 8+） | 后台处理受限 | 连接保持能力 |
| **短信集成** | 原生支持 | 不支持 | Android 独有功能 |
| **屏幕录制** | MediaProjection API | 有限支持 | 能力差异 |
| **文件访问** | 更灵活 | 受限 | 媒体处理能力 |
| **电池管理** | 可配置优化 | 受限 | 续航影响 |

#### Android 节点的核心优势

```
┌─────────────────────────────────────────────────────────────┐
│                    Android 节点核心优势                        │
│                                                              │
│   优势 1：短信集成（SMS/MMS）                                │
│   ┌───────────────────────────────────────────────────┐  │
│   │   Android 独有功能                                  │  │
│   │   ├── 接收短信并转发给 agent                        │  │
│   │   ├── 通过 agent 回复短信                          │  │
│   │   └── 自动化短信处理规则                            │  │
│   └───────────────────────────────────────────────────┘  │
│                                                              │
│   优势 2：持久的前台服务                                    │
│   ┌───────────────────────────────────────────────────┐  │
│   │   Android 8+ 的前台服务机制                        │  │
│   │   ├── 持久通知保持服务运行                         │  │
│   │   ├── 用户明确知道服务状态                         │  │
│   │   └── 比 iOS 更可靠的连接保持                      │  │
│   └───────────────────────────────────────────────────┘  │
│                                                              │
│   优势 3：丰富的媒体 API                                    │
│   ┌───────────────────────────────────────────────────┐  │
│   │   MediaProjection 和 Camera2 API                  │  │
│   │   ├── 高质量照片捕获                              │  │
│   │   ├── 灵活的视频录制参数                          │  │
│   │   └── 屏幕录制更稳定                              │  │
│   └───────────────────────────────────────────────────┘  │
│                                                              │
│   优势 4：灵活的文件系统访问                                │
│   ┌───────────────────────────────────────────────────┐  │
│   │   Android 存储访问权限                            │  │
│   │   ├── 直接访问媒体文件                           │  │
│   │   ├── 导出截图和录像                            │  │
│   │   └── 与其他应用共享内容                         │  │
│   └───────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

### 核心术语解析

| 术语 | 英文原文 | 说明 |
|------|----------|------|
| **NSD** | Network Service Discovery | Android 的服务发现 API |
| **mDNS** | Multicast DNS | 多播 DNS，用于局域网发现 |
| **前台服务** | Foreground Service | Android 8+ 要求的后台服务类型 |
| **MediaProjection** | MediaProjection | Android 屏幕捕获 API |
| **SMS** | Short Message Service | 短信服务 |

---

## 第二部分：渐进式学习路径

### 阶段一：入门基础 ⭐

**目标**：完成 Android 应用的安装和基本配对

#### 1.1 安装与应用界面

**安装方式**：

```
Android 应用分发方式：
├── Google Play Store（公开发布后）
├── F-Droid（开源版本）
├── APK 直接安装（开发版本）
└── 侧载安装（企业内部分发）
```

**应用权限要求**：

| 权限 | 用途 | 是否必需 |
|------|------|----------|
| **网络访问** | WebSocket 连接网关 | ✅ 必需 |
| **本地网络发现** | NSD/mDNS 发现网关 | ✅ 推荐 |
| **相机** | 拍照和录像 | ⚪ 可选 |
| **麦克风** | 语音唤醒、Talk Mode | ⚪ 可选 |
| **位置** | 获取设备位置 | ⚪ 可选 |
| **短信** | 短信收发 | ⚪ 可选 |
| **存储** | 保存媒体文件 | ⚪ 可选 |

**应用界面概览**：

```
┌─────────────────────────────────────────────────┐
│                 OpenClaw                        │
│              ─────────────────────              │
│                                                 │
│   ┌─────────────────────────────────────────┐ │
│   │  🔴 未连接                               │ │
│   │                                         │ │
│   │  网关发现已启用                          │ │
│   │  点击「设置」配置连接                    │ │
│   └─────────────────────────────────────────┘ │
│                                                 │
│   ┌─────────────────────────────────────────┐ │
│   │  📡 发现的网关                           │ │
│   │  ┌───────────────────────────────────┐ │ │
│   │  │ Home Gateway                      │ │ │
│   │  │ 192.168.1.100:18789              │ │ │
│   │  │ 「连接」                          │ │ │
│   │  └───────────────────────────────────┘ │ │
│   └─────────────────────────────────────────┘ │
│                                                 │
│   ┌─────────────────────────────────────────┐ │
│   │         节点功能                        │ │
│   │  ┌─────────┐  ┌─────────┐  ┌───────┐ │ │
│   │  │  Canvas │  │  相机   │  │ 短信  │ │ │
│   │  └─────────┘  └─────────┘  └───────┘ │ │
│   │  ┌─────────┐  ┌─────────┐  ┌───────┐ │ │
│   │  │ 屏幕录制 │  │  语音   │  │ 聊天  │ │ │
│   │  └─────────┘  └─────────┘  └───────┘ │ │
│   └─────────────────────────────────────────┘ │
└─────────────────────────────────────────────────┘
```

#### 1.2 网关发现与连接

**为什么需要发现机制**：Android 节点需要找到网络中的网关才能建立连接。NSD 是 Android 的标准方案。

**发现流程**：

```
步骤 1：确保网关已启动并可被发现
├── 在网关主机上检查：dns-sd -B _openclaw-gw._tcp local.
├── 或使用：openclaw gateway discover
└── 预期看到：_openclaw-gw._tcp. local. IN PTR ...

步骤 2：在 Android 应用中查看发现的网关
├── 应用自动扫描局域网（NSD）
├── 列出可用的网关服务
└── 显示网关名称、主机、端口

步骤 3：点击连接
├── 应用尝试建立 WebSocket 连接
├── 如果成功，进入配对流程
└── 如果失败，检查网络配置或使用手动主机
```

**NSD 发现原理**：

```
┌─────────────────────────────────────────────────────────────┐
│                    NSD 发现流程                               │
│                                                              │
│   Android 应用              NSD Manager         网关主机      │
│      │                        │                    │          │
│      │  1. 注册服务          │                    │          │
│      │ ────────────────────▶ │                    │          │
│      │                       │  2. 广播服务        │          │
│      │                       │ ─────────────────▶ │          │
│      │                       │                    │          │
│      │  3. 发现网关         │                    │          │
│      │ ◀──────────────────── │                    │          │
│      │                       │                    │          │
│      │  4. 获取服务信息     │                    │          │
│      │ ────────────────────▶ │                    │          │
│      │ ◀──────────────────── │                    │          │
│      │                       │                    │          │
│      │  5. 连接 WebSocket  │                    │          │
│      │ ─────────────────────────────────────────▶│          │
└─────────────────────────────────────────────────────────────┘
```

#### 1.3 配对流程

**为什么需要配对**：配对建立网关与节点之间的信任关系，确保只有授权设备可以连接。

**配对步骤**：

```
┌─────────────────────────────────────────────────────────────┐
│                      配对流程                                │
│                                                              │
│   Android 节点                 网关主机                     │
│      │                          │                            │
│      │  1. 连接 WebSocket      │                            │
│      │ ──────────────────────▶ │                            │
│      │                          │                            │
│      │  2. 发送配对请求        │                            │
│      │  (包含设备信息)          │                            │
│      │ ──────────────────────▶ │                            │
│      │                          │                            │
│      │                          │  3. 管理员批准             │
│      │                          │  openclaw nodes approve    │
│      │                          │                            │
│      │  4. 配对完成             │                            │
│      │ ◀───────────────────── │                            │
│      │                          │                            │
└─────────────────────────────────────────────────────────────┘
```

**CLI 批准命令**：

```bash
# 查看待批准请求
openclaw nodes pending

# 输出示例：
# Request ID: abc123
# Device: Pixel 7 (Android 14)
# Created: 2024-01-01 00:00:00

# 批准配对请求
openclaw nodes approve abc123

# 或使用完整请求 ID
openclaw nodes approve "abc123-Pixel 7-Android"
```

**手动主机配置（备用方案）**：

当 NSD 发现失败时，可以手动指定网关地址：

```
在 Android 应用中：
1. 打开设置
2. 启用「手动主机」
3. 输入网关主机地址
   ├── 局域网：<gateway-host>.local 或 IP 地址
   ├── Tailnet：<gateway-host>.tailnet.ts.net
   └── 远程：完整 URL
4. 输入端口（默认 18789）
5. 点击连接
```

---

### 阶段二：核心功能 ⭐⭐

**目标**：掌握 Canvas、相机、屏幕录制和短信功能

#### 2.1 Canvas 功能详解

**Canvas 架构**：

```
┌─────────────────────────────────────────────────────────────┐
│                    Canvas 渲染架构                            │
│                                                              │
│   ┌─────────────────────────────────────────────────────┐  │
│   │                    网关端                            │  │
│   │   ┌─────────────────────────────────────────────┐  │  │
│   │   │   Canvas 主机服务                           │  │  │
│   │   │   ├── HTTP 服务 (:18793)                   │  │  │
│   │   │   ├── 静态文件服务                         │  │  │
│   │   │   └── A2UI 端点 (/__openclaw__/a2ui/)     │  │  │
│   │   └─────────────────────────────────────────────┘  │  │
│   └────────────────────────┬────────────────────────────┘  │
│                            │                                 │
│                            ▼ WebSocket                       │
│   ┌─────────────────────────────────────────────────────┐  │
│   │                    Android 节点                       │  │
│   │   ┌─────────────────────────────────────────────┐  │  │
│   │   │   Android System WebView                    │  │  │
│   │   │   ├── 导航到网关 Canvas 主机 URL             │  │  │
│   │   │   ├── 接收 agent 的 canvas.* 命令           │  │  │
│   │   │   └── 截图并返回 base64 图像                │  │  │
│   │   └─────────────────────────────────────────────┘  │  │
│   └─────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

**使用 Canvas**：

```bash
# 从网关主机发送 Canvas 命令

# 1. 导航到 Canvas
openclaw nodes invoke \
  --node "Android Node" \
  --command canvas.navigate \
  --params '{"url":"http://<gateway-host>:18793/__openclaw__/canvas/"}'

# 2. 执行 JavaScript
openclaw nodes invoke \
  --node "Android Node" \
  --command canvas.eval \
  --params '{"javaScript":"(() => { const {ctx} = window.__openclaw; ctx.fillStyle = \"#2196F3\"; ctx.fillRect(20, 20, 200, 100); return \"drawn\"; })()"}'

# 3. 截图
openclaw nodes invoke \
  --node "Android Node" \
  --command canvas.snapshot \
  --params '{"maxWidth":1080,"format":"jpeg"}'

# 4. A2UI 推送
openclaw nodes invoke \
  --node "Android Node" \
  --command canvas.a2ui.push \
  --params '{"content":"Hello from agent"}'
```

#### 2.2 相机功能

**相机功能说明**：

| 功能 | 命令 | 说明 |
|------|------|------|
| **拍照** | `camera.snap` | 捕获静态图片（jpg 格式） |
| **录像** | `camera.clip` | 录制视频片段（mp4 格式） |

**使用相机**：

```bash
# 拍照（默认参数）
openclaw nodes invoke \
  --node "Android Node" \
  --command camera.snap

# 录像（默认 5 秒）
openclaw nodes invoke \
  --node "Android Node" \
  --command camera.clip

# 自定义参数
openclaw nodes invoke \
  --node "Android Node" \
  --command camera.clip \
  --params '{"duration":10000,"maxSize":52428800}'

# 高质量拍照
openclaw nodes invoke \
  --node "Android Node" \
  --command camera.snap \
  --params '{"quality":95}'
```

**相机权限**：相机功能需要用户在 Android 设置中授予相机权限。

#### 2.3 屏幕录制

**屏幕录制说明**：

```
Android 屏幕录制使用 MediaProjection API。

权限要求：
├── 用户必须明确授权
├── 授权有效期有限（部分设备每次都需要）
└── 通知栏显示录制状态
```

**使用屏幕录制**：

```bash
# 开始录制
openclaw nodes invoke \
  --node "Android Node" \
  --command screen.record

# 自定义参数
openclaw nodes invoke \
  --node "Android Node" \
  --command screen.record \
  --params '{"duration":30000,"maxSize":104857600,"bitRate":8000000}'

# 参数说明：
# duration：录制时长（毫秒）
# maxSize：最大文件大小（字节）
# bitRate：比特率（比特/秒）
```

**限制与注意事项**：

| 限制 | 说明 |
|------|------|
| **权限有效期** | 部分设备每次录制都需要重新授权 |
| **通知栏** | 录制时显示持续通知 |
| **设备策略** | 企业 MDM 可能限制屏幕录制 |
| **电池消耗** | 屏幕录制消耗大量电量 |

#### 2.4 短信功能（Android 独有）

**短信功能说明**：

```
Android 短信集成允许：
├── 接收短信并转发给 agent
├── 通过 agent 回复短信
├── 自动化短信处理规则
└── 短信历史记录
```

**配置短信功能**：

```
在 Android 应用中：
1. 打开设置
2. 启用「短信功能」
3. 授权短信权限
4. 设置短信转发规则（可选）
   ├── 全部转发
   ├── 仅来自联系人的短信
   └── 仅特定号码
```

**使用短信**：

```bash
# 查看最近短信
openclaw nodes invoke \
  --node "Android Node" \
  --command sms.list \
  --params '{"limit":20}'

# 发送短信
openclaw nodes invoke \
  --node "Android Node" \
  --command sms.send \
  --params '{"to":"+15551234567","message":"Hello from OpenClaw"}'

# 监听新短信（需要设置回调）
openclaw nodes invoke \
  --node "Android Node" \
  --command sms.subscribe
```

---

### 阶段三：高级配置 ⭐⭐⭐

**目标**：掌握前台服务、电池优化和 Tailnet 集成

#### 3.1 前台服务配置

**为什么需要前台服务**：Android 8+ 限制了后台服务。前台服务是保持网关连接的唯一可靠方式。

**前台服务工作原理**：

```
┌─────────────────────────────────────────────────────────────┐
│                    前台服务架构                               │
│                                                              │
│   ┌─────────────────────────────────────────────────────┐  │
│   │                    用户视角                           │  │
│   │   ┌─────────────────────────────────────────────┐  │  │
│   │   │   通知栏                                       │  │  │
│   │   │   ┌───────────────────────────────────────┐ │  │
│   │   │   │   🟢 OpenClaw 正在运行                │ │  │
│   │   │   │   点击展开更多操作                     │ │  │
│   │   │   └───────────────────────────────────────┘ │  │  │
│   │   └─────────────────────────────────────────────┘  │  │
│   │                         │                            │  │
│   │                         ▼ 点击                       │  │
│   │   ┌─────────────────────────────────────────────┐  │  │
│   │   │   通知详情                                   │  │  │
│   │   │   ├── 网关状态：已连接                       │  │  │
│   │   │   ├── 最后活动：刚刚                         │  │  │
│   │   │   └── 操作按钮                               │  │  │
│   │   │       ├── 断开连接                           │  │  │
│   │   │       └── 打开应用                           │  │  │
│   │   └─────────────────────────────────────────────┘  │  │
│   └─────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

**配置前台服务**：

```markdown
### 前台服务配置选项

在 Android 应用设置中：

1. 启用「前台服务」
2. 配置通知标题
3. 设置通知优先级
4. 配置后台行为
   ├── 网络保持策略
   ├── 心跳间隔
   └── 重连策略
```

**电池优化影响**：

| 设置 | 电池影响 | 连接可靠性 |
|------|----------|------------|
| **已优化（默认）** | 省电 | 后台连接可能被限制 |
| **未优化** | 耗电 | 连接更可靠 |
| **白名单** | 中等 | 推荐平衡方案 |

#### 3.2 电池优化设置

**为什么需要电池优化**：Android 的电池优化机制会限制后台应用的活动，需要合理配置以平衡性能和续航。

**电池优化配置**：

```
在 Android 设备上：
1. 打开「设置」→「电池」
2. 点击「电池优化」
3. 找到「OpenClaw」
4. 选择「未优化」或「所有应用」

推荐设置：
├── OpenClaw：未优化（保持连接）
├── 后台活动：允许
├── 自启动：启用
└── 通知：显示
```

**省电模式影响**：

```
省电模式启用时：
├── 心跳间隔增加（连接稳定性下降）
├── 后台网络受限
├── 前台服务可能降级
└── 建议：使用时关闭省电模式
```

**应用内电池设置**：

```
在 OpenClaw 应用设置中：

1. 心跳间隔
   ├── 正常：30 秒
   ├── 省电：60 秒
   └── 最低：120 秒

2. 重连策略
   ├── 立即重连（耗电）
   ├── 指数退避（推荐）
   └── 仅 WiFi 重连

3. 后台网络
   ├── 始终允许
   └── 仅 WiFi（省电）
```

#### 3.3 Tailnet 跨网络连接

**为什么需要 Tailnet**：当 Android 设备与网关不在同一网络时，需要跨网络方案。

**Tailnet 集成**：

```
┌─────────────────────────────────────────────────────────────┐
│                    Tailnet 跨网络架构                         │
│                                                              │
│   Android 设备（任何位置）              网关主机（家中）      │
│   ┌─────────────────────┐              ┌─────────────────┐ │
│   │  Tailscale 客户端   │◄─加密隧道───▶│ Tailscale 客户端│ │
│   │  虚拟 IP: 100.x.x.x │              │ 虚拟 IP: 100.y.y│ │
│   └─────────────────────┘              └─────────────────┘ │
│           │                                    │           │
│           │  WebSocket (通过 Tailscale)       │           │
│           └──────────────────────────────────┘           │
│                     gateway:18789                         │
└─────────────────────────────────────────────────────────────┘
```

**DNS-SD 配置**：

当 NSD 被网络隔离阻止时，使用 unicast DNS-SD：

```bash
# 在网关主机上配置 DNS-SD 区域（示例使用 CoreDNS）

# 1. 创建 CoreDNS 配置
cat > /etc/coredns/openclaw.zone <<'EOF'
openclaw.internal.  IN NS ns.openclaw.internal.
ns.openclaw.internal. IN A <DNS 服务器 IP>

_openclaw-gw._tcp.openclaw.internal. IN SRV 0 0 18789 gateway.openclaw.internal.
gateway.openclaw.internal. IN A <网关主机 Tailnet IP>
EOF

# 2. 在 Tailscale 管理控制台配置 split DNS
```

**Android 端配置**：

```
在 Android 应用中：
1. 确保 Tailscale 已安装并连接
2. 打开 OpenClaw 设置
3. 发现模式选择「Tailnet」
4. 输入自定义域名（如 openclaw.internal.）
5. 应用自动搜索该域名的网关
```

---

### 阶段四：专家技巧 ⭐⭐⭐⭐

**目标**：掌握生命周期管理、性能优化和问题诊断

#### 4.1 Android 生命周期管理

**应用状态**：

```
┌─────────────────────────────────────────────────────────────┐
│                    Android 应用状态机                         │
│                                                              │
│                    ┌─────────────┐                          │
│                    │   未运行     │                          │
│                    └──────┬──────┘                          │
│                           │ 用户启动应用                      │
│                           ▼                                  │
│                    ┌─────────────┐                          │
│              ┌───▶│   活动状态   │◌──┐                     │
│              │    └──────┬──────┘   │                     │
│              │           │          │                     │
│              │           ▼          │                     │
│              │    ┌─────────────┐   │                     │
│              │    │   暂停状态   │───┘                     │
│              │    │  (用户切换) │  用户返回应用             │
│              │    └──────┬──────┘                          │
│              │           │ 系统内存压力                      │
│              │           ▼                                  │
│              │    ┌─────────────┐                          │
│              │    │   停止状态   │                          │
│              │    │  (后台)    │                          │
│              │    └──────┬──────┘                          │
│              │           │ 系统回收或用户清除                  │
│              │           ▼                                  │
│              │    ┌─────────────┐                          │
│              │    │   已销毁     │                          │
│              │    └──────┬──────┘                          │
│              │           │ 应用重新启动                      │
│              └───────────┘                                  │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

**前台服务 vs 后台服务**：

| 状态 | 前台服务 | 后台服务 |
|------|----------|----------|
| **网络连接** | ✅ 稳定 | ⚠️ 可能断开 |
| **电池消耗** | 中等 | 低 |
| **用户通知** | 显示 | 不显示 |
| **优先级** | 高 | 低 |
| **系统回收** | 不易被回收 | 容易被回收 |

#### 4.2 性能优化

**网络性能**：

```markdown
### 1. 心跳优化

{
  "heartbeatInterval": 30000,  // 毫秒
  "heartbeatTimeout": 10000    // 毫秒
}

### 2. 重连策略

{
  "reconnect": {
    "immediate": false,         // 立即重连
    "exponentialBackoff": true, // 指数退避
    "maxDelay": 60000,         // 最大延迟
    "maxRetries": 10           // 最大重试次数
  }
}

### 3. WiFi 优先

{
  "wifiOnly": false,           // WiFi 和移动网络
  "wifiPriority": true         // WiFi 优先重连
}
```

**媒体性能**：

```markdown
### 1. 相机优化

// 使用适当的分辨率
{
  "photo": {
    "maxWidth": 2048,
    "quality": 85
  },
  "video": {
    "maxDuration": 30000,
    "bitRate": 4000000,
    "frameRate": 30
  }
}

### 2. Canvas 优化

// 限制截图尺寸
{
  "snapshot": {
    "maxWidth": 1080,
    "format": "webp",
    "quality": 80
  }
}
```

#### 4.3 问题诊断

**诊断命令**：

```bash
# 网关主机上的诊断

# 1. 查看节点列表
openclaw nodes status

# 2. 查看节点详情
openclaw gateway call node.describe --params '{"nodeId":"<node-id>"}'

# 3. 查看 WebSocket 连接
openclaw gateway call node.list

# 4. 查看节点发送的事件
openclaw gateway call event.subscribe --params '{"filter":"node.*"}'
```

**日志分析**：

```
在 Android 上获取日志：
├── 通过 USB 调试获取
├── 使用 adb logcat
└── 关键日志标签：
    ├── WebSocket: 连接状态、消息
    ├── Node: 节点管理
    ├── Camera: 相机操作
    ├── Screen: 屏幕录制
    ├── SMS: 短信处理
    └── Battery: 电池状态
```

---

## 第三部分：专家思维模型

### 思维模型一：电池寿命与功能平衡

**核心思想**：在 Android 上，功能可用性和电池寿命之间需要找到平衡点。

```
┌─────────────────────────────────────────────────────────────┐
│                    电池优化决策矩阵                          │
│                                                              │
│   功能需求              电池消耗        推荐配置             │
│   ─────────────────────────────────────────────────────   │
│   ─────────────────┬─────────────┬─────────────────────    │
│   持续连接（高优先级） │    高      │ 前台服务 + 未优化       │
│   ─────────────────┼─────────────┼─────────────────────    │
│   定期检查（中优先级） │    中      │ 后台服务 + 心跳优化    │
│   ─────────────────┼─────────────┼─────────────────────    │
│   按需连接（低优先级） │    低      │ 仅使用时连接           │
│   ─────────────────┴─────────────┴─────────────────────    │
│                                                              │
│   决策流程：                                                 │
│   1. 确定功能优先级                                         │
│   2. 选择最小满足需求的配置                                 │
│   3. 测试实际电池影响                                       │
│   4. 根据反馈微调                                          │
└─────────────────────────────────────────────────────────────┘
```

### 思维模型二：短信自动化规则

**核心思想**：短信功能可以构建自动化工作流，提高效率。

```
┌─────────────────────────────────────────────────────────────┐
│                    短信自动化规则设计                          │
│                                                              │
│   规则触发器：                                               │
│   ├── 接收来自特定号码的短信                                 │
│   ├── 包含特定关键词                                       │
│   └── 时间条件                                              │
│                                                              │
│   规则动作：                                                │
│   ├── 转发给 agent 处理                                     │
│   ├── 自动回复预设消息                                      │
│   ├── 标记重要短信                                          │
│   └── 触发其他操作（如日历事件）                            │
│                                                              │
│   示例规则：                                                │
│   ┌─────────────────────────────────────────────────────┐ │
│   │   规则名称：银行短信监控                               │ │
│   │   ─────────────────────────────────────────────     │ │
│   │   触发条件：                                          │ │
│   │   ├── 来源：+95588（银行号码）                       │ │
│   │   └── 关键词：交易、余额                              │ │
│   │   ─────────────────────────────────────────────     │ │
│   │   动作：                                              │ │
│   │   ├── 转发给 agent 分析                              │ │
│   │   ├── 标记为重要                                     │ │
│   │   └── 推送通知到手机                                  │ │
│   └─────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

### 思维模型三：多设备协同策略

**核心思想**：Android 节点应该与其他设备协同，形成完整的生态系统。

```
┌─────────────────────────────────────────────────────────────┐
│                    多设备协同策略                            │
│                                                              │
│   ┌─────────────────────────────────────────────────────┐  │
│   │                     设备角色分配                       │  │
│   │   ─────────────────────────────────────────────     │  │
│   │                                                         │  │
│   │   Android 节点                                        │  │
│   │   ├── 短信中心（接收/发送短信）                       │  │
│   │   ├── 外出时的移动连接点                              │  │
│   │   ├── 相机和屏幕录制                                 │  │
│   │   └── 位置追踪（可选）                               │  │
│   │                                                         │  │
│   │   配合设备：                                          │  │
│   │   ├── macOS：系统命令、复杂计算                       │  │
│   │   ├── iOS：移动端语音交互                            │  │
│   │   └── Linux 服务器：24/7 运行                        │  │
│   │                                                         │  │
│   └─────────────────────────────────────────────────────┘  │
│                                                              │
│   协同场景：                                                │
│   1. 外出时使用 Android 节点                               │
│   2. 回家后切换到 macOS 节点                               │
│   3. 短信由 Android 统一处理                               │
│   4. 复杂任务交给服务器处理                                 │
└─────────────────────────────────────────────────────────────┘
```

---

## 第四部分：适用场景分析

### 场景一：移动办公助手

**典型用户**：需要随时随地访问家中网关的设备

**推荐配置**：

```
网络配置：
├── 主要连接：Tailnet（Dogscale）
├── 备用连接：手动主机（IP 直连）
└── 发现模式：Tailnet DNS-SD

功能优先级：
├── 1. 短信（保持通信）
├── 2. Talk Mode（语音对话）
├── 3. 相机（拍照记录）
└── 4. Canvas（查看可视化内容）
```

**电池优化建议**：

```
├── 启用前台服务（保持连接）
├── 设置心跳间隔为 30 秒
├── 仅 WiFi 下自动同步大文件
└── 外出时使用省电模式
```

### 场景二：智能家居控制中心

**典型用户**：使用 Android 设备作为智能家居控制节点

**推荐配置**：

```
短信功能配置：
├── 接收来自智能设备的通知短信
├── 通过短信触发自动化场景
└── 重要短信转发到 agent 分析

自动化规则：
├── 「门已打开」→ 发送通知到所有设备
├── 「温度异常」→ 调整空调并通知
└── 「有人在家」→ 关闭安防模式
```

### 场景三：移动内容创作

**典型用户**：使用 Android 设备进行视觉内容创作

**推荐配置**：

```
功能配置：
├── Canvas：用于查看和标注
├── 相机：高质量拍照和录像
├── 屏幕录制：教程和演示
└── A2UI：与 agent 协作设计

工作流程：
1. 使用 Android 拍摄素材
2. 通过 OpenClaw 发送给 agent 分析
3. Agent 提供建议后继续创作
4. 使用 Canvas 展示和讨论
```

---

## 第五部分：故障排查指南

### 排查流程图

```
问题：Android 节点无法正常工作
│
├── 症状：无法发现网关
│   │
│   ├── 检查 1：网关是否运行？
│   │   └── 在网关主机：openclaw gateway status
│   │       │
│   │       └── 未运行 → 启动网关
│   │
│   ├── 检查 2：网络连通性
│   │   └── 确认 Android 和网关在同一网络
│   │
│   └── 检查 3：NSD 服务
│       └── 在网关主机：dns-sd -B _openclaw-gw._tcp local.
│           │
│           └── 无输出 → Bonjour 未发布
│
├── 症状：连接失败
│   │
│   ├── 检查 1：配对状态
│   │   └── 在网关主机：openclaw nodes pending
│   │       │
│   │       └── 有待处理请求 → 批准配对
│   │
│   ├── 检查 2：手动主机配置
│   │   └── 确认主机地址和端口正确
│   │
│   └── 检查 3：网络防火墙
│       └── 确认网关端口未被阻止
│
├── 症状：连接频繁断开
│   │
│   ├── 检查 1：电池优化设置
│   │   └── 确认 OpenClaw 未被优化
│   │
│   ├── 检查 2：前台服务状态
│   │   └── 确认服务正在运行
│   │
│   └── 检查 3：网络稳定性
│       └── 测试网络连接质量
│
├── 症状：相机无法使用
│   │
│   ├── 检查 1：权限
│   │   └── Android 设置 → 应用 → OpenClaw → 权限
│   │       │
│   │       └── 未授予 → 开启相机权限
│   │
│   ├── 检查 2：应用状态
│   │   └── 确认应用在前台运行
│   │
│   └── 检查 3：相机是否被占用
│       └── 关闭其他使用相机的应用
│
├── 症状：短信功能不工作
│   │
│   ├── 检查 1：短信权限
│   │   └── Android 设置 → 应用 → OpenClaw → 权限
│   │
│   ├── 检查 2：短信功能是否启用
│   │   └── 在应用设置中确认
│   │
│   └── 检查 3：短信应用冲突
│       └── 检查默认短信应用设置
│
└── 症状：屏幕录制失败
    │
    ├── 检查 1：MediaProjection 权限
    │   └── 每次录制需要重新授权
    │
    ├── 检查 2：通知权限
    │   └── 录制需要通知权限
    │
    └── 检查 3：设备策略
        └── 企业 MDM 可能限制录制
```

### 常见错误码与解决方案

| 错误码 | 含义 | 解决方案 |
|--------|------|----------|
| `CONNECTION_LOST` | 连接丢失 | 检查网络、重连配置 |
| `PAIRING_TIMEOUT` | 配对超时 | 重新发起配对 |
| `CAMERA_IN_USE` | 相机被占用 | 关闭其他应用 |
| `SCREEN_RECORD_DENIED` | 录制权限被拒 | 重新授权 |
| `SMS_PERMISSION_DENIED` | 短信权限缺失 | 授予权限 |
| `FOREGROUND_REQUIRED` | 需要前台服务 | 启用前台服务 |
| `BATTERY_OPTIMIZED` | 已被电池优化 | 添加到白名单 |

### 诊断命令速查表

```bash
# 在网关主机上

# 1. 查看节点列表
openclaw nodes status

# 2. 查看待批准配对
openclaw nodes pending

# 3. 查看节点详情
openclaw nodes describe <node-id>

# 4. 查看 WebSocket 连接
openclaw gateway call node.list --params "{}"

# 5. 查看节点事件
openclaw gateway call event.subscribe --params '{"filter":"node.*"}'

# 6. 发现网关
openclaw gateway discover --json

# 7. 查看配置
openclaw config show
```

---

## 第六部分：最佳实践总结

### 连接最佳实践

```markdown
### 1. 稳定的网络连接

**推荐配置**：
- 优先使用 Tailnet（Dogscale）连接
- 配置自动重连（指数退避）
- 使用前台服务保持连接

### 2. 及时配对批准

**设置提醒**：配置系统通知，在有配对请求时及时批准。

### 3. 备用连接方式

**配置手动主机**：
- 记录网关的静态 IP 或域名
- 配置 Tailscale MagicDNS
```

### 电池最佳实践

```markdown
### 1. 前台服务配置

{
  "foregroundService": {
    "enabled": true,
    "notificationTitle": "OpenClaw 已连接",
    "heartbeatInterval": 30000
  }
}

### 2. 电池白名单

- 将 OpenClaw 添加到电池优化白名单
- 禁用省电模式下的后台限制
- 允许自启动

### 3. 心跳优化

{
  "heartbeat": {
    "interval": 30000,
    "timeout": 10000,
    "wifiOnly": false
  }
}
```

### 功能使用最佳实践

```markdown
### 1. Canvas 优化

- 使用适当的截图尺寸
- 避免在 Canvas 上渲染过大内容
- 及时清理不需要的 Canvas 内容

### 2. 相机使用

- 拍照前确认光线充足
- 录像后及时处理素材
- 清理不需要的媒体文件
- 使用适当的分辨率

### 3. 屏幕录制

- 录制前确认权限
- 控制录制时长
- 及时导出和清理

### 4. 短信功能

- 设置合理的转发规则
- 创建自动化处理规则
- 定期清理短信历史
```

---

## 功能对比

| 功能 | Android 节点 | iOS 节点 | macOS 节点 |
|------|--------------|----------|------------|
| **Canvas** | ✅ | ✅ | ✅ |
| **聊天** | ✅ | ✅ | ✅ |
| **相机拍照** | ✅ | ✅ | ✅ |
| **相机录像** | ✅ | ✅ | ✅ |
| **屏幕录制** | ✅ | ✅ | ✅ |
| **语音唤醒** | ✅ | ✅ | ✅ |
| **Talk Mode** | ✅ | ✅ | ✅ |
| **位置获取** | ✅ | ✅ | ✅ |
| **SMS** | ✅ | ❌ | ❌ |
| **系统命令** | ❌ | ❌ | ✅ |
| **托管网关** | ❌ | ❌ | ✅ |

---

## 相关文档

- [配对机制](/zh-cn/gateway/pairing)
- [发现机制](/zh-cn/gateway/discovery)
- [Bonjour 服务发现](/zh-cn/gateway/bonjour)
- [Canvas 参考](/zh-cn/platforms/mac/canvas)
- [节点功能参考](/zh-cn/nodes)
- [语音唤醒](/zh-cn/nodes/voicewake)
- [对话模式](/zh-cn/nodes/talk)
- [相机节点](/zh-cn/nodes/camera)
