---
summary: "OpenClaw iOS 节点应用完整指南：网关连接、Canvas 渲染、语音唤醒与功能配置"
read_when:
  - 在 iOS 设备上安装和配置 OpenClaw 节点应用
  - 理解 iOS 节点如何与网关进行通信和配对
  - 配置 Canvas 渲染、语音唤醒和对话模式
  - 排查 iOS 节点的连接和功能问题
title: "iOS 应用"
---

# OpenClaw iOS 节点应用完整指南

本指南全面介绍 OpenClaw 在 iOS 平台上的节点应用。iOS 应用作为 OpenClaw 的**移动节点**，能够将 iPhone 或 iPad 的功能（如 Canvas 渲染、相机、屏幕录制、语音）暴露给网关，使 agent 能够在移动设备上执行操作。阅读本指南后，你将能够完成 iOS 节点的配对和连接，配置各项功能，并理解其架构设计和限制条件。

## 学习目标

完成本章节学习后，你将能够：

### 基础目标（必掌握）

- [ ] 理解 **iOS 节点的角色定位**，明确它与网关、macOS 节点的功能边界
- [ ] 掌握 **网关配对流程**：从发现网关到完成配对的全过程
- [ ] 完成 **基本连接验证**：确认 iOS 节点与网关的 WebSocket 连接正常
- [ ] 理解 **Bonjour 发现机制**，能够诊断局域网发现失败的问题

### 进阶目标（建议掌握）

- [ ] 掌握 **Canvas 功能配置**：通过 WKWebView 实现网页渲染和截图
- [ ] 配置 **语音唤醒**：在后台监听唤醒词并触发 agent
- [ ] 理解 **A2UI 集成**：使用 agent 驱动的可视化界面
- [ ] 能够使用 **手动主机配置**，在 Bonjour 不可用时建立连接

### 专家目标（挑战）

- [ ] 理解 **Tailnet 跨网络发现**，配置 DNS-SD 实现远程连接
- [ ] 掌握 **节点生命周期管理**：前后台切换、连接保持策略
- [ ] 能够排查 **复杂的网络问题**：防火墙、NAT、mDNS 限制
- [ ] 设计 **多设备协同架构**：iOS 节点与其他设备的配合使用

---

## 第一部分：核心概念与架构设计

### iOS 节点的设计理念

在移动设备上运行 AI agent 的节点是一个独特的架构决策。理解其设计理念有助于你更好地使用这些功能，并理解其固有的限制。

#### 节点架构的核心思想

```
┌─────────────────────────────────────────────────────────────┐
│                    iOS 节点架构                              │
│                                                              │
│   ┌─────────────────────────────────────────────────────┐  │
│   │                    用户交互层                         │  │
│   │   ┌───────────┐  ┌───────────┐  ┌───────────┐     │  │
│   │   │  设置界面  │  │  状态显示  │  │  语音界面  │     │  │
│   │   └───────────┘  └───────────┘  └───────────┘     │  │
│   └────────────────────────┬────────────────────────────┘  │
│                            │                                 │
│   ┌─────────────────────────────────────────────────────┐  │
│   │                    应用核心层                          │  │
│   │   ┌─────────────────────────────────────────────┐  │  │
│   │   │              节点管理模块                      │  │  │
│   │   │   ├── WebSocket 连接管理                     │  │  │
│   │   │   ├── 服务发现（Bonjour/NSD）               │  │  │
│   │   │   └── 配对状态机                            │  │  │
│   │   └─────────────────────────────────────────────┘  │  │
│   └────────────────────────┬────────────────────────────┘  │
│                            │                                 │
│   ┌─────────────────────────────────────────────────────┐  │
│   │                    功能暴露层                          │  │
│   │   ┌──────────┐ ┌──────────┐ ┌──────────┐        │  │
│   │   │  Canvas  │ │  Camera  │ │  Audio   │        │  │
│   │   │  WKWebView│ │  拍照/录像 │ │  语音识别 │        │  │
│   │   └──────────┘ └──────────┘ └──────────┘        │  │
│   └────────────────────────┬────────────────────────────┘  │
│                            │                                 │
│   ┌─────────────────────────────────────────────────────┐  │
│   │                    通信协议层                          │  │
│   │          WebSocket（网关连接）+ node.invoke 协议       │  │
│   └─────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

#### 为什么使用 WKWebView 实现 Canvas

**技术选型理由**：

| 方案 | 优点 | 缺点 |
|------|------|------|
| **WKWebView** | 原生渲染、iOS 最佳支持、JavaScript 互操作 | 需要 WebSocket 通信 |
| **Core Animation** | 高性能、GPU 加速 | 开发复杂、JavaScript 支持差 |
| **Metal** | 最高性能 | 开发成本极高、仅图形 |

**为什么选择 WKWebView**：

1. **JavaScript 互操作**：Canvas.eval 需要执行 JavaScript 代码，WKWebView 提供原生支持
2. **A2UI 集成**：A2UI 基于 Web 技术，WKWebView 是最自然的载体
3. **开发效率**：Web 开发人才充足，迭代速度快
4. **资源效率**：利用 iOS 的 WebKit 优化，资源占用合理

#### 移动节点的独特挑战

```
┌─────────────────────────────────────────────────────────────┐
│                    移动节点挑战                             │
│                                                              │
│   挑战 1：后台执行受限                                       │
│   ┌───────────────────────────────────────────────────┐   │
│   │   iOS 后台限制                                    │   │
│   │   ├── 后台应用刷新受限                            │   │
│   │   ├── 后台网络连接受限                            │   │
│   │   └── 后台音频受限                                │   │
│   │                                                  │   │
│   │   影响：Voice Wake 在后台可能无法持续监听          │   │
│   │   应对：使用后台音频会话延长执行时间               │   │
│   └───────────────────────────────────────────────────┘   │
│                                                              │
│   挑战 2：资源限制                                          │
│   ┌───────────────────────────────────────────────────┐   │
│   │   iOS 资源管理                                    │   │
│   │   ├── 内存限制严格（应用级）                       │   │
│   │   ├── CPU 节流（省电模式）                        │   │
│   │   └── 存储空间有限                                │   │
│   │                                                  │   │
│   │   影响：Canvas 大页面、长时间录像可能失败           │   │
│   │   应对：优化资源使用、及时释放资源                 │   │
│   └───────────────────────────────────────────────────┘   │
│                                                              │
│   挑战 3：网络隔离                                          │
│   ┌───────────────────────────────────────────────────┐   │
│   │   移动网络限制                                    │   │
│   │   ├── 运营商 NAT 导致 mDNS 不可用                 │   │
│   │   ├── 防火墙限制                                  │   │
│   │   └── 公共 WiFi 隔离                             │   │
│   │                                                  │   │
│   │   影响：局域网发现可能失败                         │   │
│   │   应对：提供手动主机配置、Tailnet 方案             │   │
│   └───────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

### 核心术语解析

| 术语 | 英文原文 | 说明 |
|------|----------|------|
| **节点** | Node | 暴露平台功能的客户端 |
| **配对** | Pairing | 建立网关与节点信任关系的过程 |
| **发现** | Discovery | 定位可用网关的过程 |
| **Bonjour** | Bonjour | Apple 的 mDNS 服务发现协议 |
| **NSD** | Network Service Discovery | Android 等效的发现协议 |
| **WKWebView** | WKWebView | iOS 的 WebKit 网页视图组件 |
| **A2UI** | A2 User Interface | agent 驱动的可视化界面 |

---

## 第二部分：渐进式学习路径

### 阶段一：入门基础 ⭐

**目标**：完成 iOS 应用的安装和基本配对

#### 1.1 安装与应用界面

**为什么先讲安装**：iOS 应用尚未公开发布，目前处于内部预览阶段。安装方式与正式发布应用不同。

**安装方式（内部预览）**：

```
注意：iOS 应用当前处于内部预览阶段。

安装途径：
├── TestFlight 测试（如果可用）
├── Xcode 直接部署（开发者）
└── 企业分发（组织内部）
```

**应用界面概览**：

```
┌─────────────────────────────────────────────────┐
│                    OpenClaw                     │
│                 ─────────────────────────────  │
│                                                 │
│   ┌─────────────────────────────────────────┐ │
│   │  🔴 未连接                               │ │
│   │                                         │ │
│   │  未发现网关                              │ │
│   │                                         │ │
│   │  ┌───────────────────────────────────┐ │ │
│   │  │         设置齿轮图标              │ │ │
│   │  └───────────────────────────────────┘ │ │
│   └─────────────────────────────────────────┘ │
│                                                 │
│   ┌─────────────────────────────────────────┐ │
│   │         发现的网关列表                    │ │
│   │         （自动刷新）                      │ │
│   └─────────────────────────────────────────┘ │
│                                                 │
│   ┌─────────────────────────────────────────┐ │
│   │         节点功能                        │ │
│   │  ┌─────────┐  ┌─────────┐             │ │
│   │  │ Canvas  │  │  相机   │             │ │
│   │  └─────────┘  └─────────┘             │ │
│   │  ┌─────────┐  ┌─────────┐             │ │
│   │  │  语音   │  │  对话   │             │ │
│   │  └─────────┘  └─────────┘             │ │
│   └─────────────────────────────────────────┘ │
└─────────────────────────────────────────────────┘
```

#### 1.2 网关发现与连接

**为什么需要发现机制**：iOS 节点需要找到网络中的网关才能建立连接。Bonjour 是 Apple 生态的标准方案。

**发现流程**：

```
步骤 1：确保网关已启动并可被发现
├── 在网关主机上检查：dns-sd -B _openclaw-gw._tcp local.
├── 或使用：openclaw gateway discover
└── 预期看到：_openclaw-gw._tcp. local. IN PTR ...

步骤 2：在 iOS 应用中查看发现的网关
├── 应用自动扫描局域网
├── 列出 _openclaw-gw._tcp 服务
└── 显示网关名称、主机、端口

步骤 3：点击连接
├── 应用尝试建立 WebSocket 连接
├── 如果成功，进入配对流程
└── 如果失败，检查网络配置
```

**发现机制详解**：

| 发现方式 | 说明 | 适用场景 |
|----------|------|----------|
| **Bonjour（局域网）** | 通过 mDNS 自动发现 | 同网络设备 |
| **手动主机** | 手动输入网关地址 | 发现失败时 |
| **Tailnet** | 通过 DNS-SD 跨网络发现 | 远程连接 |

#### 1.3 配对流程

**为什么需要配对**：配对建立网关与节点之间的信任关系，确保只有授权设备可以连接。

**配对步骤**：

```
┌─────────────────────────────────────────────────────────────┐
│                      配对流程                                │
│                                                              │
│   iOS 节点                    网关主机                       │
│      │                          │                            │
│      │  1. 连接 WebSocket      │                            │
│      │ ──────────────────────▶ │                            │
│      │                          │                            │
│      │  2. 发送配对请求        │                            │
│      │  (包含设备信息)          │                            │
│      │ ──────────────────────▶ │                            │
│      │                          │                            │
│      │                          │  3. 管理员批准             │
│      │                          │  openclaw nodes approve    │
│      │                          │                            │
│      │  4. 配对完成             │                            │
│      │ ◀───────────────────── │                            │
│      │                          │                            │
└─────────────────────────────────────────────────────────────┘
```

**CLI 批准命令**：

```bash
# 查看待批准请求
openclaw nodes pending

# 输出示例：
# Request ID: abc123
# Device: iPhone (iOS 17.2)
# Created: 2024-01-01 00:00:00

# 批准配对请求
openclaw nodes approve abc123

# 或使用完整请求 ID
openclaw nodes approve "abc123-设备名-iOS"
```

**验证配对成功**：

```bash
# 在网关主机上检查节点状态
openclaw nodes status

# 输出示例：
# ┌─────────────────────────────────────────┐
# │ 节点列表                                 │
# ├─────────────────────────────────────────┤
# │ iPhone (iOS)                            │
# │   ID: abc123                            │
# │   状态: 在线                             │
# │   功能: canvas, camera, voice            │
# │   最后活动: 刚刚                          │
# └─────────────────────────────────────────┘
```

---

### 阶段二：核心功能 ⭐⭐

**目标**：掌握 Canvas、相机和基本功能配置

#### 2.1 Canvas 功能详解

**为什么需要 Canvas**：Canvas 允许 agent 在 iOS 设备上渲染可视化内容，支持交互式工作空间。

**Canvas 架构**：

```
┌─────────────────────────────────────────────────────────────┐
│                    Canvas 渲染架构                            │
│                                                              │
│   ┌─────────────────────────────────────────────────────┐  │
│   │                    网关端                            │  │
│   │   ┌─────────────────────────────────────────────┐  │  │
│   │   │   Canvas 主机服务                           │  │  │
│   │   │   ├── HTTP 服务 (:18793)                   │  │  │
│   │   │   ├── 静态文件服务                          │  │  │
│   │   │   └── A2UI 端点 (/__openclaw__/a2ui/)      │  │  │
│   │   └─────────────────────────────────────────────┘  │  │
│   └────────────────────────┬────────────────────────────┘  │
│                            │                                 │
│                            ▼ WebSocket                       │
│   ┌─────────────────────────────────────────────────────┐  │
│   │                    iOS 节点                           │  │
│   │   ┌─────────────────────────────────────────────┐  │  │
│   │   │   WKWebView                                │  │  │
│   │   │   ├── 导航到网关 Canvas 主机 URL            │  │  │
│   │   │   ├── 接收 agent 的 canvas.* 命令          │  │  │
│   │   │   └── 截图并返回 base64 图像               │  │  │
│   │   └─────────────────────────────────────────────┘  │  │
│   └─────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

**使用 Canvas**：

```bash
# 从网关主机发送 Canvas 命令

# 1. 导航到 Canvas
openclaw nodes invoke \
  --node "iPhone" \
  --command canvas.navigate \
  --params '{"url":"http://<gateway-host>:18793/__openclaw__/canvas/"}'

# 2. 执行 JavaScript
openclaw nodes invoke \
  --node "iPhone" \
  --command canvas.eval \
  --params '{"javaScript":"(() => { const {ctx} = window.__openclaw; ctx.fillStyle = \"#ff2d55\"; ctx.fillRect(10, 10, 100, 100); return \"drawn\"; })()"}'

# 3. 截图
openclaw nodes invoke \
  --node "iPhone" \
  --command canvas.snapshot \
  --params '{"maxWidth":900,"format":"jpeg"}'
```

#### 2.2 相机功能

**相机功能说明**：

| 功能 | 命令 | 说明 |
|------|------|------|
| **拍照** | `camera.snap` | 捕获静态图片（jpg 格式） |
| **录像** | `camera.clip` | 录制视频片段（mp4 格式） |

**使用相机**：

```bash
# 拍照
openclaw nodes invoke \
  --node "iPhone" \
  --command camera.snap

# 录像（默认 5 秒）
openclaw nodes invoke \
  --node "iPhone" \
  --command camera.clip

# 自定义时长（10 秒）
openclaw nodes invoke \
  --node "iPhone" \
  --command camera.clip \
  --params '{"duration":10000}'
```

**权限要求**：相机功能需要用户在 iOS 设置中授予相机权限。

#### 2.3 手动主机配置

**为什么需要手动配置**：当 Bonjour 发现失败时（如网络隔离、mDNS 被阻止），需要手动指定网关地址。

**配置步骤**：

```
在 iOS 应用中：
1. 打开设置
2. 启用「手动主机」
3. 输入网关主机地址
   ├── 局域网：<gateway-host>.local 或 IP 地址
   └── 远程：<gateway-host>.tailnet.ts.net 或 IP 地址
4. 输入端口（默认 18789）
5. 点击连接
```

**常见场景**：

| 场景 | 主机地址示例 |
|------|-------------|
| **同一 WiFi，IP 地址** | `192.168.1.100` |
| **Bonjour 可用** | `openclaw-gateway.local` |
| **Tailnet** | `gateway.tailnet.ts.net` |
| **Tailscale MagicDNS** | `gateway-name.tailnet-name.ts.net` |

---

### 阶段三：高级配置 ⭐⭐⭐

**目标**：掌握语音唤醒、Tailnet 集成和高级功能

#### 3.1 语音唤醒

**为什么需要语音唤醒**：Voice Wake 允许你通过语音唤醒 agent，无需手动操作设备。

**工作原理**：

```
┌─────────────────────────────────────────────────────────────┐
│                    语音唤醒架构                               │
│                                                              │
│   ┌─────────────────────────────────────────────────────┐  │
│   │                    iOS 设备                           │  │
│   │   ┌─────────────────────────────────────────────┐  │  │
│   │   │   音频引擎                                  │  │  │
│   │   │   ├── 麦克风输入（持续监听）                │  │  │
│   │   │   ├── 本地语音识别（离线）                  │  │  │
│   │   │   └── 唤醒词检测                            │  │  │
│   │   └─────────────────────────────────────────────┘  │  │
│   │                        │                            │  │
│   │                        ▼ 检测到唤醒词                 │  │
│   │   ┌─────────────────────────────────────────────┐  │  │
│   │   │   触发动作                                  │  │  │
│   │   │   ├── 激活应用                             │  │  │
│   │   │   ├── 发送消息到网关                        │  │  │
│   │   │   └── 启动 Talk Mode                       │  │  │
│   │   └─────────────────────────────────────────────┘  │  │
│   └─────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

**配置步骤**：

```
在 iOS 应用中：
1. 打开设置
2. 启用「语音唤醒」
3. 设置唤醒词（自定义或默认）
4. 授权麦克风权限
5. 测试唤醒效果
```

**限制与注意事项**：

| 限制 | 说明 |
|------|------|
| **后台运行** | iOS 可能暂停后台音频处理 |
| **电池消耗** | 持续监听消耗电量 |
| **环境噪音** | 嘈杂环境可能影响识别准确性 |
| **唤醒词** | 建议选择独特词汇，避免误触发 |

#### 3.2 Talk Mode

**Talk Mode 说明**：Talk Mode 提供持续对话能力，类似语音助手（如 Siri）的交互模式。

**使用场景**：

```
对话模式工作流：
1. 通过语音唤醒或手动启动
2. 设备进入「监听状态」
3. 用户说话 → 语音识别 → 发送给 agent
4. Agent 回复 → 语音合成 → 播放
5. 重复步骤 3-4
6. 用户说「结束」或超时自动退出
```

**配置选项**：

```
在 iOS 应用设置中：
├── 自动语音合成：开关
├── 语音选择：系统语音
├── 语言：简体中文/英文等
├── 持续时间：30秒/60秒/无限
└── 退出命令：「结束」、「停止」
```

#### 3.3 Tailnet 跨网络连接

**为什么需要 Tailnet**：当 iOS 设备与网关不在同一网络时（如外出时访问家中网关），需要跨网络方案。Tailscale 提供了安全简便的解决方案。

**Tailnet 集成**：

```
┌─────────────────────────────────────────────────────────────┐
│                    Tailnet 跨网络架构                         │
│                                                              │
│   iOS 设备（任何位置）                    网关主机（家中）    │
│   ┌─────────────────────┐              ┌─────────────────┐ │
│   │  Tailscale 客户端   │◄─加密隧道───▶│ Tailscale 客户端│ │
│   │  虚拟 IP: 100.x.x.x │              │ 虚拟 IP: 100.y.y│ │
│   └─────────────────────┘              └─────────────────┘ │
│           │                                    │           │
│           │  WebSocket (通过 Tailscale)       │           │
│           └──────────────────────────────────┘           │
│                     gateway:18789                         │
└─────────────────────────────────────────────────────────────┘
```

**DNS-SD 配置**：

当 mDNS 被网络隔离阻止时，使用 unicast DNS-SD：

```bash
# 在网关主机上配置 DNS-SD 区域（示例使用 CoreDNS）

# 1. 创建 CoreDNS 配置
cat > /etc/coredns/openclaw.zone <<'EOF'
openclaw.internal.  IN NS ns.openclaw.internal.
ns.openclaw.internal. IN A <DNS 服务器 IP>

_openclaw-gw._tcp.openclaw.internal. IN SRV 0 0 18789 gateway.openclaw.internal.
gateway.openclaw.internal. IN A <网关主机 Tailnet IP>
EOF

# 2. 在 Tailscale 管理控制台配置 split DNS
# 添加 DNS 区域：openclaw.internal
```

**iOS 端配置**：

```
在 iOS 应用中：
1. 确保 Tailscale 已连接
2. 打开 OpenClaw 设置
3. 发现模式选择「Tailnet」
4. 输入自定义域名（如 openclaw.internal.）
5. 应用自动搜索该域名的网关
```

---

### 阶段四：专家技巧 ⭐⭐⭐⭐

**目标**：掌握生命周期管理、性能优化和问题诊断

#### 4.1 节点生命周期管理

**iOS 应用状态**：

```
┌─────────────────────────────────────────────────────────────┐
│                    iOS 应用状态机                            │
│                                                              │
│                    ┌─────────────┐                          │
│                    │   未运行     │                          │
│                    └──────┬──────┘                          │
│                           │ 用户打开应用                      │
│                           ▼                                  │
│                    ┌─────────────┐                          │
│              ┌───▶│   前台运行   │◀──┐                     │
│              │    └──────┬──────┘   │                     │
│              │           │          │                     │
│              │           ▼          │                     │
│              │    ┌─────────────┐   │                     │
│              │    │   暂停      │───┘                     │
│              │    │  (应用切换) │  用户返回前台             │
│              │    └──────┬──────┘                          │
│              │           │ iOS 内存压力                      │
│              │           ▼                                  │
│              │    ┌─────────────┐                          │
│              │    │   终止      │                          │
│              │    └──────┬──────┘                          │
│              │           │ 应用被杀死                       │
│              └───────────┘                                  │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

**状态对功能的影响**：

| 状态 | Canvas | 相机 | 语音 | 网络 |
|------|--------|------|------|------|
| **前台运行** | ✅ 正常 | ✅ 正常 | ✅ 正常 | ✅ 保持 |
| **暂停** | ⚠️ 暂停 | ❌ 不可用 | ⚠️ 受限 | ⚠️ 可能断开 |
| **终止** | ❌ 不可用 | ❌ 不可用 | ❌ 不可用 | ❌ 断开 |

**最佳实践**：

```markdown
### 1. 保持连接

- 最小化应用切换频率
- 使用「后台应用刷新」保持活跃
- 在设置中禁用「后台活动」的限制

### 2. 资源管理

- 完成相机操作后及时释放资源
- 避免同时运行多个资源密集型功能
- 监控内存使用，避免 iOS 终止应用

### 3. 自动重连

应用应实现：
- 检测 WebSocket 断开
- 自动尝试重新连接
- 使用指数退避策略
```

#### 4.2 性能优化

**Canvas 性能**：

```markdown
### 1. 截图优化

// 限制截图尺寸减少处理时间
{
  "maxWidth": 600,  // 降低分辨率
  "format": "jpeg", // jpeg 比 png 更快
  "quality": 0.7    // 降低质量
}

### 2. JavaScript 执行

// 避免复杂操作
const simpleOp = "(() => { ctx.fillStyle = 'red'; ctx.fillRect(0, 0, 100, 100); return 'done'; })()";

// 避免复杂操作
complexOp = "(() => { for(let i=0; i<10000; i++) { /* ... */ } })()";
```

**网络性能**：

```markdown
### 1. 减少网络往返

// 批量操作
{
  "commands": [
    {"command": "canvas.eval", "params": {"javaScript": "..."}},
    {"command": "canvas.snapshot", "params": {"maxWidth": 600}}
  ]
}

### 2. 选择合适的压缩

// 图片压缩
{
  "format": "webp",  // 比 jpeg 更好的压缩率
  "maxWidth": 800
}
```

#### 4.3 问题诊断

**诊断命令**：

```bash
# 网关主机上的诊断

# 1. 查看节点列表
openclaw nodes status

# 2. 查看节点详情
openclaw gateway call node.describe --params '{"nodeId":"<node-id>"}'

# 3. 查看 WebSocket 连接
openclaw gateway call node.list

# 4. 查看节点发送的事件
openclaw gateway call event.subscribe --params '{"filter":"node.*"}'
```

**日志分析**：

```bash
# 在 iOS 上获取日志（通过 Xcode 或 TestFlight）

# 关键日志标签
# - WebSocket: 连接状态、消息
# - Node: 节点管理
# - Camera: 相机操作
# - Voice: 语音唤醒
# - Canvas: 渲染操作
```

---

## 第三部分：专家思维模型

### 思维模型一：资源受限设计

**核心思想**：iOS 是资源受限环境，所有功能设计必须考虑资源限制。

```
┌─────────────────────────────────────────────────────────────┐
│                    iOS 资源受限设计思维                        │
│                                                              │
│   资源预算分配（示例）：                                       │
│   ┌─────────────────────────────────────────────────────┐  │
│   │                                                         │  │
│   │   内存预算：                                           │  │
│   │   ├── WebView 基础：50MB                             │  │
│   │   ├── Canvas 页面：20-100MB（取决于复杂度）            │  │
│   │   ├── 相机缓存：10-30MB                             │  │
│   │   └── 预留余量：20MB                                 │  │
│   │                                                         │  │
│   │   CPU 预算：                                          │  │
│   │   ├── 语音唤醒检测：10%                              │  │
│   │   ├── Canvas 渲染：30%                              │  │
│   │   └── 系统预留：60%                                  │  │
│   │                                                         │  │
│   │   网络预算：                                          │  │
│   │   ├── WebSocket 心跳：~1KB/min                      │  │
│   │   ├── Canvas 数据：100KB-1MB/操作                     │  │
│   │   └── 相机数据：500KB-10MB/操作                      │  │
│   │                                                         │  │
│   └─────────────────────────────────────────────────────┘  │
│                                                              │
│   设计原则：                                                 │
│   ├── 及时释放不需要的资源                                    │  │
│   ├── 避免同时运行多个资源密集型功能                         │  │
│   ├── 提供用户可见的资源使用状态                              │  │
│   └── 在资源紧张时主动降级功能                               │  │
└─────────────────────────────────────────────────────────────┘
```

### 思维模型二：网络可达性评估

**核心思想**：在尝试连接前评估网络可达性，避免无效尝试。

```
┌─────────────────────────────────────────────────────────────┐
│                    网络可达性评估流程                          │
│                                                              │
│   开始连接                                                   │
│       │                                                     │
│       ▼                                                     │
│   ┌───────────────────────┐                                │
│   │ 是否在同一局域网？       │                                │
│   └───────────┬───────────┘                                │
│       │               │                                   │
│       ▼               ▼                                   │
│     是              否                                    │
│       │               │                                   │
│       ▼               ▼                                   │
│   ┌───────────┐   ┌───────────────────────┐               │
│   │ Bonjour  │   │ 是否已连接 Tailnet？   │               │
│   │ 发现      │   └───────────┬───────────┘               │
│   └─────┬─────┘       │               │                   │
│         │             ▼               ▼                   │
│         │           是              否                     │
│         │             │               │                   │
│         ▼             ▼               ▼                   │
│   ┌───────────┐   ┌───────────┐   ┌───────────────────┐│
│   │ 连接网关   │   │ DNS-SD   │   │ 提示用户          ││
│   │           │   │ 发现      │   │ 手动配置或        ││
│   └─────┬─────┘   └─────┬─────┘   │ 使用移动网络      ││
│         │               │         └───────────────────┘│
│         ▼               ▼                                │
│   ┌───────────┐   ┌───────────┐                        │
│   │ 成功？    │   │ 成功？    │                        │
│   └─────┬─────┘   └─────┬─────┘                        │
│         │               │                               │
│         ▼               ▼                               │
│       是              否                                │
│         │               │                               │
│         ▼               ▼                               │
│   ┌───────────┐   ┌───────────┐                        │
│   │ 连接建立   │   │ 提示用户  │                        │
│   │           │   │ 手动配置   │                        │
│   └───────────┘   └───────────┘                        │
└─────────────────────────────────────────────────────────────┘
```

### 思维模型三：功能可用性矩阵

**核心思想**：根据应用状态评估功能可用性，提供清晰的错误信息。

```
┌─────────────────────────────────────────────────────────────┐
│                    功能可用性矩阵                              │
│                                                              │
│   功能          │ 前台运行 │ 暂停 │ 终止 │ 无网络             │
│   ──────────────┼─────────┼──────┼──────┼────────            │
│   Canvas 渲染   │   ✅    │  ⚠️  │  ❌  │  ❌               │
│   Canvas 截图   │   ✅    │  ❌  │  ❌  │  ❌               │
│   相机拍照      │   ✅    │  ❌  │  ❌  │  ⚠️ (本地)         │
│   相机录像      │   ✅    │  ❌  │  ❌  │  ⚠️ (本地)         │
│   语音唤醒      │   ✅    │  ⚠️  │  ❌  │  ✅                │
│   Talk Mode    │   ✅    │  ⚠️  │  ❌  │  ⚠️                │
│   WebSocket    │   ✅    │  ⚠️  │  ❌  │  ❌               │
│   配置修改      │   ✅    │  ✅  │  ❌  │  ✅                │
│                                                              │
│   ✅ 可用   ⚠️ 受限   ❌ 不可用                              │
└─────────────────────────────────────────────────────────────┘
```

---

## 第四部分：适用场景分析

### 场景一：移动办公助手

**典型用户**：需要在外出时访问家中网关的设备

**推荐配置**：

```
网络配置：
├── 主要连接：Tailnet（Dogscale）
├── 备用连接：手动主机（IP 直连）
└── 发现模式：Tailnet DNS-SD

功能优先级：
├── 1. Talk Mode（语音对话）
├── 2. 相机（拍照记录）
├── 3. Canvas（查看可视化内容）
└── 4. 语音唤醒（需要时触发）
```

**工作流程**：

```
1. 离开家前确保：
   ├── Tailscale 已安装并连接
   └── iOS 应用已配对并测试连接

2. 外出时：
   ├── 打开 Tailscale 确保连接
   ├── 打开 OpenClaw 应用
   └── 使用 Talk Mode 进行对话
```

### 场景二：移动内容创作

**典型用户**：需要使用 iOS 设备进行视觉内容创作

**推荐配置**：

```
功能配置：
├── Canvas：用于查看和标注
├── 相机：高质量拍照和录像
├── 截图：定期捕获工作内容
└── A2UI：与 agent 协作设计

工作流程：
1. 使用 iPhone/iPad 拍摄素材
2. 通过 OpenClaw 发送给 agent 分析
3. Agent 提供建议后继续创作
4. 使用 Canvas 展示和讨论
```

### 场景三：多设备协同

**典型用户**：拥有多个 OpenClaw 设备的用户

**推荐架构**：

```
┌─────────────────────────────────────────────────────────────┐
│                    多设备协同架构                              │
│                                                              │
│   ┌─────────────┐    ┌─────────────┐    ┌─────────────┐   │
│   │   Mac     │    │   iPhone   │    │   iPad     │   │
│   │ (网关主机) │◄──▶│   节点     │◄──▶│   节点     │   │
│   │            │    │           │    │           │   │
│   │ Canvas     │    │ 相机/语音 │    │  Canvas   │   │
│   │ system.run │    │ 移动便利  │    │ 大屏显示  │   │
│   └─────────────┘    └─────────────┘    └─────────────┘   │
│                                                              │
└─────────────────────────────────────────────────────────────┘

功能分配策略：
├── 需要系统命令 → 使用 Mac
├── 外出携带 → 使用 iPhone
├── 大屏协作 → 使用 iPad
└── 统一入口 → 所有设备连接到同一网关
```

---

## 第五部分：故障排查指南

### 排查流程图

```
问题：iOS 节点无法正常工作
│
├── 症状：无法发现网关
│   │
│   ├── 检查 1：网关是否运行？
│   │   └── 在网关主机：openclaw gateway status
│   │       │
│   │       └── 未运行 → 启动网关
│   │
│   ├── 检查 2：网络连通性
│   │   └── 确认 iOS 和网关在同一网络
│   │
│   └── 检查 3：Bonjour 服务
│       └── 在网关主机：dns-sd -B _openclaw-gw._tcp local.
│           │
│           └── 无输出 → Bonjour 未发布
│
├── 症状：连接失败
│   │
│   ├── 检查 1：配对状态
│   │   └── 在网关主机：openclaw nodes pending
│   │       │
│   │       └── 有待处理请求 → 批准配对
│   │
│   ├── 检查 2：手动主机配置
│   │   └── 确认主机地址和端口正确
│   │
│   └── 检查 3：网络防火墙
│       └── 确认网关端口未被阻止
│
├── 症状：Canvas 不工作
│   │
│   ├── 检查 1：Canvas 主机配置
│   │   └── 在网关主机检查 canvasHost 配置
│   │
│   ├── 检查 2：权限
│   │   └── 确认 iOS 授予了网络权限
│   │
│   └── 检查 3：URL 可达
│       └── 手动在 Safari 打开 Canvas URL
│
├── 症状：相机无法使用
│   │
│   ├── 检查 1：权限
│   │   └── iOS 设置 → OpenClaw → 相机
│   │       │
│   │       └── 未授予 → 开启权限
│   │
│   ├── 检查 2：应用状态
│   │   └── 确认应用在前台运行
│   │
│   └── 检查 3：相机是否被占用
│       └── 关闭其他使用相机的应用
│
└── 症状：语音唤醒不工作
    │
    ├── 检查 1：麦克风权限
    │   └── iOS 设置 → OpenClaw → 麦克风
    │
    ├── 检查 2：应用状态
    │   └── 语音唤醒需要应用至少在后台运行
    │
    └── 检查 3：唤醒词
        └── 尝试更换唤醒词
```

### 常见错误码与解决方案

| 错误码 | 含义 | 解决方案 |
|--------|------|----------|
| `NODE_BACKGROUND_UNAVAILABLE` | 应用在后台 | 将应用置于前台 |
| `A2UI_HOST_NOT_CONFIGURED` | Canvas 主机未配置 | 检查网关 canvasHost 配置 |
| `PAIRING_TIMEOUT` | 配对超时 | 重新发起配对 |
| `WEBSOCKET_ERROR` | WebSocket 连接失败 | 检查网络和防火墙 |
| `CAMERA_PERMISSION_DENIED` | 相机权限缺失 | 在 iOS 设置中授予 |
| `VOICE_PERMISSION_DENIED` | 麦克风权限缺失 | 在 iOS 设置中授予 |

### 诊断命令速查表

```bash
# 在网关主机上

# 1. 查看节点列表
openclaw nodes status

# 2. 查看待批准配对
openclaw nodes pending

# 3. 查看节点详情
openclaw nodes describe <node-id>

# 4. 查看 WebSocket 连接
openclaw gateway call node.list --params "{}"

# 5. 查看节点事件
openclaw gateway call event.subscribe --params '{"filter":"node.*"}'

# 6. 发现网关
openclaw gateway discover --json

# 7. 查看配置
openclaw config show
```

---

## 第六部分：最佳实践总结

### 连接最佳实践

```markdown
### 1. 稳定的网络连接

**推荐配置**：
- 优先使用 Tailnet（Dogscale）连接
- 配置自动重连
- 使用指数退避策略

### 2. 及时配对批准

**设置提醒**：配置系统通知，在有配对请求时及时批准。

### 3. 备用连接方式

**配置手动主机**：
- 记录网关的静态 IP 或域名
- 配置 Tailscale MagicDNS
```

### 功能使用最佳实践

```markdown
### 1. Canvas 优化

- 使用适当的截图尺寸
- 避免在 Canvas 上渲染过大内容
- 及时清理不需要的 Canvas 内容

### 2. 相机使用

- 拍照前确认光线充足
- 录像后及时处理素材
- 清理不需要的媒体文件

### 3. 语音唤醒

- 选择不常用的唤醒词
- 定期检查唤醒效果
- 在安静环境测试
```

### 资源管理最佳实践

```markdown
### 1. 定期检查

- 监控应用内存使用
- 及时清理不需要的资源
- 重启应用释放资源

### 2. 省电配置

- 禁用不需要的功能
- 降低截图质量
- 减少后台活动
```

---

## 功能对比

| 功能 | iOS 节点 | Android 节点 | macOS 节点 |
|------|----------|--------------|------------|
| **Canvas** | ✅ | ✅ | ✅ |
| **聊天** | ✅ | ✅ | ✅ |
| **相机拍照** | ✅ | ✅ | ✅ |
| **相机录像** | ✅ | ✅ | ✅ |
| **屏幕录制** | ✅ | ✅ | ✅ |
| **语音唤醒** | ✅ | ✅ | ✅ |
| **Talk Mode** | ✅ | ✅ | ✅ |
| **位置获取** | ✅ | ✅ | ✅ |
| **SMS** | ❌ | ✅ | ❌ |
| **系统命令** | ❌ | ❌ | ✅ |
| **托管网关** | ❌ | ❌ | ✅ |

---

## 相关文档

- [配对机制](/zh-cn/gateway/pairing)
- [发现机制](/zh-cn/gateway/discovery)
- [Bonjour 服务发现](/zh-cn/gateway/bonjour)
- [Canvas 参考](/zh-cn/platforms/mac/canvas)
- [节点功能参考](/zh-cn/nodes)
- [语音唤醒](/zh-cn/nodes/voicewake)
- [对话模式](/zh-cn/nodes/talk)
