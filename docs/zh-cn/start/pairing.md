---
summary: "配对与安全机制详解 - DM 安全、审批流程和访问控制"
read_when:
  - 理解 DM 安全策略
  - 配置配对审批
  - 设置访问控制
title: "配对与安全"
---

# 🔐 配对与安全

**目标**：深入理解 OpenClaw 的配对机制和安全策略，掌握如何安全地控制 AI 助手的消息接收。

本指南专为需要**完全理解**安全机制的用户设计，包括个人用户和团队管理员。

---

## 🎯 学习目标

完成本指南学习后，你将能够：

### 基础目标（必掌握）

- [ ] 理解配对机制的设计理念和核心价值
- [ ] 配置不同渠道的私信策略
- [ ] 审批和管理配对请求
- [ ] 管理白名单用户

### 进阶目标（建议掌握）

- [ ] 配置高级安全选项（群组安全、IP 白名单）
- [ ] 执行安全审计和事件处理
- [ ] 理解安全事件的应对流程
- [ ] 设计适合团队的安全策略

---

## 💡 首先理解：为什么需要配对？

### 设计决策背景

```
问题：如何让 AI 助手既方便使用，又不受垃圾消息和攻击困扰？

挑战：
  - AI 可以执行命令、访问文件、发送消息
  - 如果任何人都可以发送消息，可能遭受：
    - 垃圾消息骚扰
    - 恶意提示词注入
    - 资源耗尽攻击

解决方案：设计配对（Pairing）机制

核心设计原则：
  ✅ 默认拒绝：未知用户不能直接对话
  ✅ 明确审批：管理员手动批准每个请求
  ✅ 可追溯：所有操作都有日志
  ✅ 灵活可控：多种策略可选
```

### 配对的类比理解

```
┌─────────────────────────────────────────────────────────────────┐
│                    配对机制类比：智能办公室                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  没有配对机制：                                                 │
│    ├── 任何人可以直接闯入办公室                                │
│    ├── AI 必须处理所有请求                                      │
│    ├── 无法区分朋友和陌生人                                      │
│    └── 容易遭受骚扰和攻击                                        │
│                                                                 │
│  有配对机制：                                                   │
│    ├── 陌生人需要先敲门（发送配对请求）                        │
│    ├── 你可以选择是否开门（批准或拒绝）                       │
│    ├── 只有你批准的人才能进入（AI 才会回复）                   │
│    └── 建立信任关系后，后续无需重复审批                          │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 配对机制保护什么？

| 威胁 | 没有配对 | 有配对 |
|------|----------|--------|
| **垃圾消息** | 持续骚扰，无法停止 | 直接拒绝，保护 AI 资源 |
| **提示词注入** | 可能立即执行恶意命令 | 需要审批，降低风险 |
| **资源耗尽** | 大量请求耗尽 API 配额 | 可控制消息频率 |
| **隐私泄露** | 陌生人获取对话历史 | 仅管理员可见 |

---

## 🔧 配对策略配置

### 策略类型详解

OpenClaw 支持四种私信策略，每种适用于不同场景：

```
┌─────────────────────────────────────────────────────────────────┐
│                    配对策略对比                                    │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 策略 1：pairing（推荐）                                 │   │
│  │                                                         │   │
│  │ 特点：未知用户需要配对审批                              │   │
│  │ 适用：大多数场景，平衡安全和便利                        │   │
│  │ 推荐度：⭐⭐⭐⭐⭐                                     │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 策略 2：allowlist（受控环境）                           │   │
│  │                                                         │   │
│  │ 特点：仅白名单用户可以发送消息                          │   │
│  │ 适用：团队内部、小范围使用                              │   │
│  │ 推荐度：⭐⭐⭐⭐                                         │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 策略 3：open（开放访问）                               │   │
│  │                                                         │   │
│  │ 特点：允许所有用户发送消息                              │   │
│  │ 适用：公共助手、需要开放访问的场景                      │   │
│  │ 风险：⚠️ 高风险，需谨慎使用                            │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 策略 4：disabled（禁用私信）                           │   │
│  │                                                         │   │
│  │ 特点：禁用所有私信功能                                  │   │
│  │ 适用：仅使用群组模式、不需要私信                        │   │
│  │ 推荐度：⭐⭐⭐                                           │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 配置语法

在 `openclaw.json` 中配置私信策略：

```json5
{
  "channels": {
    "whatsapp": {
      "dmPolicy": "pairing"  // pairing | allowlist | open | disabled
    }
  }
}
```

### 各渠道配置示例

#### WhatsApp 配置

```json5
{
  "channels": {
    "whatsapp": {
      "dmPolicy": "pairing",
      "allowFrom": ["+15551234567", "+15559876543"],  // 可选：始终允许的用户
      "groups": {
        "*": { "requireMention": true }  // 群组需要 @提及
      }
    }
  }
}
```

#### Telegram 配置

```json5
{
  "channels": {
    "telegram": {
      "dmPolicy": "pairing",
      "allowFrom": ["@trusted-user-1", "@trusted-user-2"],
      "groups": {
        "*": { "requireMention": false }
      }
    }
  }
}
```

#### Discord 配置

```json5
{
  "channels": {
    "discord": {
      "dm": {
        "enabled": true,
        "policy": "pairing",
        "allowFrom": ["123456789", "987654321"]  // 用户 ID
      },
      "groups": {
        "*": { "requireMention": true }
      }
    }
  }
}
```

#### Slack 配置

```json5
{
  "channels": {
    "slack": {
      "dm": {
        "enabled": true,
        "policy": "pairing"
      }
    }
  }
}
```

---

## ✅ 配对审批流程

### 审批流程详解

```
┌─────────────────────────────────────────────────────────────────┐
│                    完整审批流程                                    │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  用户发送消息                                                    │
│         ↓                                                       │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  步骤 1：检查用户状态                                     │   │
│  │                                                         │   │
│  │  - 用户是否在白名单？ → ✅ 直接处理                       │   │
│  │  - 用户是否在黑名单？ → ❌ 拒绝                          │   │
│  │  - 用户是否已配对？ → ✅ 直接处理                         │   │
│  │  - 用户是否未知？ → 进入配对流程                         │   │
│  └─────────────────────────────────────────────────────────┘   │
│         ↓                                                       │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  步骤 2：配对流程（未知用户）                            │   │
│  │                                                         │   │
│  │  1. 生成唯一配对码（UUID 格式）                         │   │
│  │  2. 存储配对请求                                         │   │
│  │  3. 通过其他渠道通知管理员（可选）                        │   │
│  │  4. 返回配对码给发送者                                   │   │
│  │  5. 等待审批                                             │   │
│  └─────────────────────────────────────────────────────────┘   │
│         ↓                                                       │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  步骤 3：管理员处理                                      │   │
│  │                                                         │   │
│  │  - 批准 → 用户加入白名单，发送确认消息                    │   │
│  │  - 拒绝 → 发送拒绝消息，记录日志                         │   │
│  │  - 忽略 → 配对码超时后自动过期                           │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 查看待审批列表

```bash
# 查看所有渠道的待审批配对
openclaw pairing list

# 查看特定渠道
openclaw pairing list whatsapp
openclaw pairing list telegram
openclaw pairing list discord

# 查看特定用户
openclaw pairing list --user "+15551234567"
```

**输出示例：**

```
待审批配对请求：
┌────────────┬─────────────────────┬──────────────────┬────────────────┐
│ 渠道      │ 配对码              │ 发送者           │ 时间           │
├────────────┼─────────────────────┼──────────────────┼────────────────┤
│ whatsapp  │ ABC123XYZ           │ +15551234567     │ 10:30         │
│ telegram  │ DEF456UVW           │ @username        │ 11:45         │
│ discord   │ GHI789ABC           │ User#1234        │ 14:20         │
└────────────┴─────────────────────┴──────────────────┴────────────────┘
```

### 批准配对

```bash
# 批准配对
openclaw pairing approve whatsapp ABC123XYZ

# 批准并添加备注
openclaw pairing approve telegram DEF456UVW --note "同事张三"

# 批量批准
openclaw pairing approve whatsapp ABC123XYZ,DEF456UVW
```

### 拒绝配对

```bash
# 拒绝配对
openclaw pairing reject whatsapp ABC123XYZ

# 拒绝并说明原因
openclaw pairing reject telegram DEF456UVW --reason "不认识此人"

# 拒绝并拉入黑名单（防止再次尝试）
openclaw pairing reject discord GHI789ABC --block
```

### 查看审批历史

```bash
# 查看已审批的用户
openclaw pairing approved

# 查看已拒绝的用户
openclaw pairing rejected

# 查看所有历史记录
openclaw pairing history

# 查看特定用户的历史
openclaw pairing history --user "+15551234567"
```

---

## 👥 白名单管理

### 白名单 vs 配对

```
┌─────────────────────────────────────────────────────────────────┐
│                    白名单 vs 配对                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  配对（Pairing）：                                              │
│    ├── 需要用户主动发起请求                                     │
│    ├── 管理员需要手动审批                                      │
│    ├── 适用于：第一次联系的用户                                  │
│    └── 优点：可控、有记录                                      │
│                                                                 │
│  白名单（Allowlist）：                                          │
│    ├── 无需审批，直接允许                                      │
│    ├── 管理员主动添加                                          │
│    ├── 适用于：已知的可信用户                                   │
│    └── 优点：便捷、批量管理                                     │
│                                                                 │
│  推荐工作流：                                                   │
│    1. 新用户 → 配对请求                                         │
│    2. 审批通过 → 加入白名单                                    │
│    3. 后续联系 → 直接处理                                       │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 手动添加白名单

```bash
# 添加用户到白名单
openclaw pairing allow whatsapp +15551234567
openclaw pairing allow telegram @username
openclaw pairing allow discord 123456789

# 添加用户并设置备注
openclaw pairing allow whatsapp +15559876543 --note "同事李四"

# 批量添加
openclaw pairing allow whatsapp +15551234567,+15559876543
```

### 查看白名单

```bash
# 查看完整白名单
openclaw pairing whitelist

# 查看特定渠道
openclaw pairing whitelist whatsapp
openclaw pairing whitelist telegram
openclaw pairing whitelist discord

# 以 JSON 格式输出
openclaw pairing whitelist --json
```

### 从白名单移除

```bash
# 移除用户
openclaw pairing unallow whatsapp +15551234567

# 移除并记录原因
openclaw pairing unallow telegram @username --reason "已离职"
```

### 白名单格式

| 渠道 | 格式示例 | 说明 |
|------|----------|------|
| **WhatsApp** | `+15551234567` | 国际格式电话号码 |
| **Telegram** | `@username` 或 `tg:123456789` | 用户名或 Telegram ID |
| **Discord** | `123456789` | Discord 用户 ID |
| **Slack** | `U12345678` | Slack 用户 ID |

---

## 🔒 高级安全配置

### 群组安全配置

群组消息默认不需要配对，但可以配置更严格的规则：

```json5
{
  "channels": {
    "whatsapp": {
      "groupPolicy": "allowlist",
      "groups": {
        // 所有群组使用白名单
        "*": {
          "requireMention": true,  // 需要 @提及才响应
          "allowFrom": ["+15551234567"]  // 可直接发言的用户
        }
      }
    }
  }
}
```

**群组配置选项：**

| 选项 | 说明 | 默认值 |
|------|------|--------|
| `requireMention` | 是否需要 @提及 | false |
| `allowFrom` | 可直接发言的用户列表 | [] |
| `denyFrom` | 禁止发言的用户列表 | [] |

### 敏感操作保护

```json5
{
  "channels": {
    "telegram": {
      "dmPolicy": "pairing",
      
      // 敏感命令白名单
      "allowFrom": ["@admin", "@trusted-user"],
      
      // 限制可访问的群组
      "groups": {
        // 群组 ID（负数表示超级群）
        "-1001234567890": {
          "allowFrom": ["@admin"]
        }
      }
    }
  }
}
```

### IP 白名单（高级）

对于通过 API 或 WebSocket 直接访问的场景：

```json5
{
  "gateway": {
    "auth": {
      "ipWhitelist": [
        "127.0.0.1",                    // 本地访问
        "192.168.1.0/24",               // 局域网
        "10.0.0.0/8"                   // 内部网络
      ]
    }
  }
}
```

---

## 📊 安全审计

### 安全检查命令

```bash
# 基本安全状态
openclaw security status

# 深度安全审计（推荐定期运行）
openclaw security audit --deep

# 检查特定方面
openclaw security audit --channels
openclaw security audit --pairing
openclaw security audit --network
```

**审计检查清单：**

```
✅ 私信策略配置检查
✅ 白名单状态验证
✅ 待审批配对数量
✅ 异常活动检测
✅ 最近拒绝记录
✅ 敏感配置审查
```

### 查看配对统计

```bash
# 配对统计概览
openclaw pairing stats

# 输出示例：
# ┌─────────────────────────────────────────────┐
# │ 配对统计                                    │
# ├─────────────────────────────────────────────┤
# │ 待审批:     2                              │
# │ 已批准:     15                             │
# │ 已拒绝:     3                              │
# │ 白名单用户:  12                             │
# │ 黑名单用户: 1                              │
# └─────────────────────────────────────────────┘

# 详细统计
openclaw pairing stats --verbose

# 按时间段统计
openclaw pairing stats --since 7d   // 最近7天
openclaw pairing stats --since 30d  // 最近30天
```

### 日志查看

```bash
# 查看配对相关日志
openclaw logs --lines 100 | grep "pairing"

# 查看特定用户的日志
openclaw logs --lines 100 | grep "+15551234567"

# 查看拒绝记录
openclaw logs --lines 100 | grep "rejected"

# 导出日志
openclaw logs --since 7d > pairing-audit.log
```

---

## 🚨 安全事件处理

### 安全事件分类

```
┌─────────────────────────────────────────────────────────────────┐
│                    安全事件分类                                   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  级别 1：低风险                                                 │
│    ├── 配对请求过多（可能是误操作）                            │
│    ├── 重复发送消息                                             │
│    └── 处理：审查后忽略                                          │
│                                                                 │
│  级别 2：中风险                                                 │
│    ├── 可疑配对请求（未知来源）                                │
│    ├── 频繁拒绝后重试                                          │
│    └── 处理：拒绝并监控                                          │
│                                                                 │
│  级别 3：高风险                                                 │
│    ├── 明确的滥用行为                                           │
│    ├── 尝试绕过安全机制                                         │
│    ├── 发送恶意内容                                              │
│    └── 处理：立即阻止并调查                                      │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 收到可疑配对请求

**检查步骤：**

```bash
# 1. 查看发送者信息
openclaw pairing list --verbose

# 2. 查看历史记录
openclaw pairing history --user "+15551234567"

# 3. 检查是否在其他渠道有记录
openclaw pairing history --all-channels --user "+15551234567"
```

**决策准则：**

| 情况 | 操作 |
|------|------|
| 认识的用户 | 批准 |
| 不认识，但有合理说明 | 批准并添加备注 |
| 不认识，无说明 | 拒绝 |
| 可疑行为 | 拒绝并拉黑 |

### 检测到滥用行为

```bash
# 1. 查看最近的异常活动
openclaw logs --lines 500 | grep -E "(rejected|blocked|rate-limit)"

# 2. 查看用户活动
openclaw pairing history --user "+15551234567"

# 3. 检查频率
openclaw pairing stats --verbose | grep "recent"
```

### 紧急措施

```bash
# 禁用所有私信（紧急情况）
openclaw config set channels.whatsapp.dmPolicy disabled
openclaw config set channels.telegram.dmPolicy disabled

# 清空白名单（谨慎！）
openclaw pairing clear --force

# 拉入黑名单
openclaw pairing block whatsapp +15551234567

# 查看攻击来源
openclaw logs --lines 500 | grep "blocked"
```

---

## ⚙️ 自动化配对（高级）

### 特定条件自动批准

```json5
{
  "channels": {
    "telegram": {
      "dmPolicy": "pairing",
      "autoApprove": {
        // 来自特定群组的成员自动批准
        "fromGroups": ["-1001234567890", "-1009876543210"],
        
        // 使用特定关键词验证
        "verificationKeywords": ["来自技术群", "团队成员"],
        
        // 信任的时间段（可选）
        "trustedHours": {
          "start": "09:00",
          "end": "18:00"
        }
      }
    }
  }
}
```

### 配对码过期配置

```json5
{
  "channels": {
    "telegram": {
      "pairingCodeExpiry": "24h",      // 24小时后过期
      "pairingCodeLength": 8            // 配对码长度（默认6）
    }
  }
}
```

### 通知配置

```json5
{
  "channels": {
    "telegram": {
      "notifications": {
        "newPairing": {
          "enabled": true,
          // 发送到指定渠道
          "notifyChannel": "whatsapp",
          "notifyUser": "+15551234567"
        }
      }
    }
  }
}
```

---

## 📝 最佳实践

### 推荐配置模板

```json5
{
  "channels": {
    // WhatsApp 配置
    "whatsapp": {
      "dmPolicy": "pairing",
      "allowFrom": [
        "+15551234567",     // 添加自己的号码
        "+15559876543"      // 可信任的联系人
      ]
    },
    
    // Telegram 配置
    "telegram": {
      "dmPolicy": "pairing",
      "allowFrom": [
        "@my-account",      // 自己的用户名
        "@trusted-colleague" // 可信任的同事
      ]
    },
    
    // Discord 配置
    "discord": {
      "dm": {
        "policy": "pairing",
        "allowFrom": []     // Discord 通常不留白名单
      }
    }
  },
  
  // 通知配置
  "notifications": {
    "newPairing": {
      "enabled": true,
      "channels": ["telegram"],
      "admins": ["@admin"]
    }
  }
}
```

### 安全检查清单

```
每日检查：
  [ ] 查看待审批配对
  [ ] 检查是否有异常拒绝

每周检查：
  [ ] 运行安全审计
  [ ] 审查白名单
  [ ] 检查配对统计

每月检查：
  [ ] 导出日志存档
  [ ] 清理过期配对
  [ ] 审查安全策略
```

### 团队协作建议

| 场景 | 推荐策略 | 说明 |
|------|----------|------|
| **个人使用** | pairing + 个人白名单 | 最高安全性 |
| **小团队** | pairing + 团队白名单 | 平衡安全和便利 |
| **开放社区** | pairing + 自动化 | 需要更多监控 |
| **公共助手** | open + 速率限制 | 高风险，需谨慎 |

---

## 📊 专家思维模型：安全决策框架

```
┌─────────────────────────────────────────────────────────────────┐
│                    安全决策流程                                   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  收到配对请求时，问自己：                                        │
│                                                                 │
│  问题 1：我认识这个人吗？                                       │
│         ↓                                                       │
│     是 → 批准（检查是否已在白名单）                             │
│     否 → 进入问题 2                                             │
│                                                                 │
│  问题 2：这个人有合理的使用场景吗？                            │
│         ↓                                                       │
│     是 → 批准并添加备注                                         │
│     否 → 进入问题 3                                             │
│                                                                 │
│  问题 3：是否有可疑行为？                                       │
│         ↓                                                       │
│     是 → 拒绝并考虑拉黑                                         │
│     否 → 根据情况决定                                           │
│                                                                 │
│  关键原则：                                                     │
│    - 默认拒绝，例外批准                                         │
│    - 记录所有决策                                               │
│    - 定期审查白名单                                             │
│    - 保持警惕但不过度敏感                                       │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 📚 知识点回顾

完成本指南后，您应该掌握以下技能：

| 技能 | 掌握程度 |
|------|----------|
| 配对机制理解 | ⭐⭐⭐⭐⭐ |
| 私信策略配置 | ⭐⭐⭐⭐ |
| 审批管理操作 | ⭐⭐⭐⭐⭐ |
| 白名单管理 | ⭐⭐⭐⭐ |
| 安全审计 | ⭐⭐⭐ |
| 事件处理 | ⭐⭐⭐ |

---

## 🎯 下一步学习

| 主题 | 文档链接 | 预计时间 |
|------|----------|----------|
| **网关安全** | [Gateway 安全](/zh-CN/gateway/authentication) | 20 分钟 |
| **CLI 命令** | [CLI 参考](/zh-CN/cli) | 30 分钟 |
| **渠道配置** | [Channels](/zh-CN/channels/index) | 45 分钟 |

---

## 📖 附录

### 附录 A：命令速查

| 命令 | 说明 |
|------|------|
| `openclaw pairing list` | 查看待审批配对 |
| `openclaw pairing approve <code>` | 批准配对 |
| `openclaw pairing reject <code>` | 拒绝配对 |
| `openclaw pairing allow <user>` | 添加到白名单 |
| `openclaw pairing unallow <user>` | 从白名单移除 |
| `openclaw pairing whitelist` | 查看白名单 |
| `openclaw pairing stats` | 配对统计 |
| `openclaw security audit` | 安全审计 |
| `openclaw pairing history` | 查看历史 |

### 附录 B：术语表

| 英文术语 | 中文术语 | 说明 |
|---------|---------|------|
| Pairing | 配对 | 安全审批机制 |
| Allowlist | 白名单 | 可信用户列表 |
| DM Policy | 私信策略 | 私信访问控制 |
| Gateway | 网关 | 核心控制平面 |
| Blocklist | 黑名单 | 被禁止的用户列表 |

### 附录 C：相关资源

- **官方文档**：[docs.openclaw.ai](https://docs.openclaw.ai)
- **GitHub**：[github.com/openclaw/openclaw](https://github.com/openclaw/openclaw)
- **安全指南**：[Security Guide](/zh-CN/gateway/security)

---

> **🔐 安全提示**：配对机制是保护您的 AI 助手的第一道防线。合理配置，定期审查，保持警惕。

> *"安全不是一次性的工作，而是持续的实践。"*
