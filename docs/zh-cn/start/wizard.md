---
summary: "CLI 引导向导：网关、工作区、渠道和技能的向导式配置"
read_when:
  - 运行或配置引导向导
  - 设置新机器
  - 理解向导流程和选项
title: "向导模式详解"
---

# 🧙 向导模式详解

引导向导是**推荐**的设置 OpenClaw 的方式，适用于 macOS、Linux 或 Windows（通过 WSL2）。

它在一个引导流程中配置本地网关或远程网关连接，以及渠道、技能和工作区默认设置。

---

## 🚀 启动向导

### 主入口

```bash
openclaw onboard
```

### 快速体验（无需配置渠道）

最快的第一次聊天：打开控制界面（无需配置渠道）。运行：

```bash
openclaw dashboard
```

然后在浏览器中聊天。文档：[仪表盘](/zh-CN/web/dashboard)。

### 重新配置

```bash
openclaw configure
```

### 推荐配置

设置 Brave Search API Key 以便代理可以使用 `web_search`（`web_fetch` 无需 key 即可工作）：

```bash
openclaw configure --section web
```

这会存储 `tools.web.search.apiKey`。详见 [Web 工具](/zh-CN/tools/web)。

---

## ⚡ 快速开始 vs 高级模式

向导开始时提供 **快速开始**（默认）与 **高级**（完全控制）的选择。

### 快速开始（推荐新手）

保持默认配置：

- 本地网关（loopback）
- 默认工作区（或现有工作区）
- 网关端口 **18789**
- 网关认证 **Token**（自动生成，即使 loopback 也启用）
- Tailscale 暴露 **关闭**
- Telegram + WhatsApp DM 默认使用 **允许列表**（会提示输入你的手机号）

### 高级模式

暴露每一步配置（模式、工作区、网关、渠道、守护进程、技能）。

---

## 📋 向导执行内容

### 本地模式（默认）

1. **模型/认证**（OAuth 或 API Key）
2. **工作区位置** + 引导文件
3. **网关设置**（端口/绑定/认证/tailscale）
4. **渠道**（Telegram、WhatsApp、Discord、Google Chat、Mattermost、Signal）
5. **守护进程安装**（LaunchAgent / systemd 用户单元）
6. **健康检查**
7. **技能**（推荐安装）

### 远程模式

仅配置本地客户端连接到其他地方的网关，**不会**在远程主机上安装或更改任何内容。

### 添加更多隔离代理

要添加更多隔离的代理（独立工作区 + 会话 + 认证）：

```bash
openclaw agents add <名称>
```

**提示**：`--json` 并不意味着非交互模式。脚本请使用 `--non-interactive`（和 `--workspace`）。

---

## 🔍 流程详情（本地模式）

### 1. 现有配置检测

- 如果 `~/.openclaw/openclaw.json` 存在，选择 **保留 / 修改 / 重置**
- 重新运行向导**不会**清除任何内容，除非你明确选择 **重置**（或传入 `--reset`）
- 如果配置无效或包含遗留键，向导会停止并要求你先运行 `openclaw doctor`
- 重置使用 `trash`（绝不会用 `rm`）并提供范围选择：
  - 仅配置
  - 配置 + 凭证 + 会话
  - 完全重置（也移除工作区）

### 2. 模型/认证

#### Anthropic API Key（推荐）

- 如果存在 `ANTHROPIC_API_KEY` 则使用，或提示输入 key
- 保存以便守护进程使用

#### Anthropic OAuth（Claude Code CLI）

- macOS：向导检查 Keychain 中的 "Claude Code-credentials" 项（选择"始终允许"以免 launchd 启动时阻塞）
- Linux/Windows：如果存在则重用 `~/.claude/.credentials.json`

#### Anthropic Token（粘贴 setup-token）

- 在任何机器上运行 `claude setup-token`
- 然后粘贴 token（可以命名；空白 = 默认）

#### OpenAI Code（Codex）订阅（Codex CLI）

- 如果存在 `~/.codex/auth.json`，向导可以重用

#### OpenAI Code（Codex）订阅（OAuth）

- 浏览器流程；粘贴 `code#state`
- 当模型未设置或为 `openai/*` 时，将 `agents.defaults.model` 设置为 `openai-codex/gpt-5.2`

#### OpenAI API Key

- 如果存在 `OPENAI_API_KEY` 则使用，或提示输入 key
- 保存到 `~/.openclaw/.env` 以便 launchd 读取

#### 其他提供商

- **OpenCode Zen**：提示输入 `OPENCODE_API_KEY`
- **Vercel AI Gateway**：提示输入 `AI_GATEWAY_API_KEY`
- **MiniMax M2.1**：配置自动写入
- **Synthetic**：提示输入 `SYNTHETIC_API_KEY`
- **Moonshot (Kimi)**：配置自动写入
- **跳过**：暂不配置认证

#### 模型选择

- 从检测到的选项中选择默认模型（或手动输入 provider/model）
- 向导运行模型检查，如果配置的模型未知或缺少认证会警告

**认证存储位置**：
- OAuth: `~/.openclaw/credentials/oauth.json`
- API Keys: `~/.openclaw/agents/<agentId>/agent/auth-profiles.json`

详见 [OAuth 概念](/zh-CN/concepts/oauth)

### 3. 工作区

- 默认 `~/.openclaw/workspace`（可配置）
- 为代理引导仪式种子所需的工作区文件
- 完整工作区布局 + 备份指南：[代理工作区](/zh-CN/concepts/agent-workspace)

### 4. 网关

- 端口、绑定、认证模式、tailscale 暴露
- **认证建议**：即使 loopback 也保持 **Token**，这样本地 WS 客户端必须认证
- 仅在完全信任每个本地进程时才禁用认证
- 非 loopback 绑定仍需认证

### 5. 渠道

- **WhatsApp**：[WhatsApp](/zh-CN/channels/whatsapp) - 可选 QR 登录
- **Telegram**：[Telegram](/zh-CN/channels/telegram) - Bot Token
- **Discord**：[Discord](/zh-CN/channels/discord) - Bot Token
- **Google Chat**：[Google Chat](/zh-CN/channels/googlechat) - 服务账户 JSON + Webhook Audience
- **Mattermost**：[Mattermost](/zh-CN/channels/mattermost)（插件）- Bot Token + Base URL
- **Signal**：[Signal](/zh-CN/channels/signal) - 可选 `signal-cli` 安装 + 账户配置
- **iMessage**：[iMessage](/zh-CN/channels/imessage) - 本地 `imsg` CLI 路径 + DB 访问

**DM 安全**：默认是配对。第一次 DM 发送一个代码；通过 `openclaw pairing approve <channel> <code>` 批准，或使用允许列表。

### 6. 守护进程安装

#### macOS: LaunchAgent

- 需要登录用户会话；无头模式请使用自定义 LaunchDaemon（未提供）

#### Linux（和 Windows 通过 WSL2）: systemd 用户单元

- 向导尝试通过 `loginctl enable-linger <user>` 启用 linger，以便网关登出后保持运行
- 可能需要 sudo（写入 `/var/lib/systemd/linger`）；先尝试无 sudo

#### 运行时选择

**Node（推荐；WhatsApp/Telegram 必需）**

⚠️ **Bun 不推荐** - 对这些渠道有兼容性问题

### 7. 健康检查

- 启动网关（如需要）并运行 `openclaw health`
- 提示：`openclaw status --deep` 在状态输出中添加网关健康探测（需要可到达的网关）

### 8. 技能（推荐）

- 读取可用技能并检查要求
- 选择节点管理器：**npm / pnpm**（不推荐 bun）
- 安装可选依赖（部分在 macOS 上使用 Homebrew）

### 9. 完成

---

## 🎓 理解向导背后的原理

### 为什么需要向导？

OpenClaw 是一个**高度可配置**的系统，向导的作用是：

1. **降低门槛**：通过问答式交互，避免直接编辑 JSON 配置
2. **确保安全**：自动生成 token、设置合理默认权限
3. **验证配置**：运行健康检查，确保配置有效
4. **最佳实践**：遵循社区推荐的安全和性能设置

### 配置文件生成

向导会生成 `~/.openclaw/openclaw.json`：

```json
{
  "gateway": {
    "port": 18789,
    "bind": "loopback",
    "auth": {
      "type": "token",
      "token": "<auto-generated>"
    }
  },
  "agents": {
    "defaults": {
      "model": "anthropic/claude-sonnet-4",
      "workspace": "~/.openclaw/workspace"
    }
  }
}
```

### 守护进程原理

**macOS LaunchAgent**：
- 用户登录时自动启动
- 随用户会话运行
- 适合个人机器

**Linux systemd**：
- 用户级服务
- 配合 linger 保持登出后运行
- 适合服务器/VPS

---

## 🐛 故障排除

### 向导卡住

```bash
# 强制重置配置
openclaw onboard --reset
```

### 配置验证失败

```bash
# 先运行诊断
openclaw doctor

# 修复问题后重新运行向导
openclaw onboard
```

### 守护进程启动失败

**macOS**：
```bash
# 检查 LaunchAgent 状态
launchctl list | grep openclaw

# 手动加载
launchctl load ~/Library/LaunchAgents/com.openclaw.gateway.plist
```

**Linux**：
```bash
# 检查 systemd 状态
systemctl --user status openclaw-gateway

# 启用 linger
loginctl enable-linger $USER

# 重新启动服务
systemctl --user restart openclaw-gateway
```

---

## 📝 下一步

完成向导后：

1. **[发送第一条消息](/zh-CN/start/getting-started#第六步配对与安全)**
2. **[配置更多渠道](/zh-CN/channels)**
3. **[了解技能系统](/zh-CN/tools/skills)**
4. **[探索 CLI 命令](/zh-CN/cli)**

---

**遇到问题？** 查看 [故障排除](/zh-CN/help/troubleshooting) 或访问 [GitHub Issues](https://github.com/openclaw/openclaw/issues)。
